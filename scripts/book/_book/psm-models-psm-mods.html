<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 PSM Models {PSM Mods} | A Mega-Analysis of Personality Predictions: Robustness and Boundary Conditions</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 PSM Models {PSM Mods} | A Mega-Analysis of Personality Predictions: Robustness and Boundary Conditions" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 PSM Models {PSM Mods} | A Mega-Analysis of Personality Predictions: Robustness and Boundary Conditions" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Emorie D. Beck" />


<meta name="date" content="2020-07-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="propensity-score-matching-psm.html"/>
<link rel="next" href="specification-curve-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Workspace</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#directory-path"><i class="fa fa-check"></i><b>1.2</b> Directory Path</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#codebook"><i class="fa fa-check"></i><b>1.3</b> Codebook</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#other-supporting-documents"><i class="fa fa-check"></i><b>1.4</b> Other Supporting Documents</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="dataCleaning.html"><a href="dataCleaning.html"><i class="fa fa-check"></i><b>2</b> Data Cleaning</a><ul>
<li class="chapter" data-level="2.1" data-path="dataCleaning.html"><a href="dataCleaning.html#add-health"><i class="fa fa-check"></i><b>2.1</b> Add Health</a><ul>
<li class="chapter" data-level="2.1.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data"><i class="fa fa-check"></i><b>2.1.1</b> Load Data</a></li>
<li class="chapter" data-level="2.1.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables"><i class="fa fa-check"></i><b>2.1.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.1.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables"><i class="fa fa-check"></i><b>2.1.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.1.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables"><i class="fa fa-check"></i><b>2.1.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.1.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates"><i class="fa fa-check"></i><b>2.1.5</b> Covariates</a></li>
<li class="chapter" data-level="2.1.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation"><i class="fa fa-check"></i><b>2.1.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="dataCleaning.html"><a href="dataCleaning.html#us"><i class="fa fa-check"></i><b>2.2</b> US</a><ul>
<li class="chapter" data-level="2.2.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-1"><i class="fa fa-check"></i><b>2.2.1</b> Load Data</a></li>
<li class="chapter" data-level="2.2.2" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-1"><i class="fa fa-check"></i><b>2.2.2</b> Outcome Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="dataCleaning.html"><a href="dataCleaning.html#bhps"><i class="fa fa-check"></i><b>2.3</b> BHPS</a><ul>
<li class="chapter" data-level="2.3.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-2"><i class="fa fa-check"></i><b>2.3.1</b> Load Data</a></li>
<li class="chapter" data-level="2.3.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-1"><i class="fa fa-check"></i><b>2.3.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.3.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-1"><i class="fa fa-check"></i><b>2.3.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.3.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-2"><i class="fa fa-check"></i><b>2.3.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.3.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-1"><i class="fa fa-check"></i><b>2.3.5</b> Covariates</a></li>
<li class="chapter" data-level="2.3.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-1"><i class="fa fa-check"></i><b>2.3.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="dataCleaning.html"><a href="dataCleaning.html#gsoep"><i class="fa fa-check"></i><b>2.4</b> GSOEP</a><ul>
<li class="chapter" data-level="2.4.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-3"><i class="fa fa-check"></i><b>2.4.1</b> Load Data</a></li>
<li class="chapter" data-level="2.4.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-2"><i class="fa fa-check"></i><b>2.4.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.4.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-2"><i class="fa fa-check"></i><b>2.4.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.4.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-3"><i class="fa fa-check"></i><b>2.4.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.4.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-2"><i class="fa fa-check"></i><b>2.4.5</b> Covariates</a></li>
<li class="chapter" data-level="2.4.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-2"><i class="fa fa-check"></i><b>2.4.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="dataCleaning.html"><a href="dataCleaning.html#hilda"><i class="fa fa-check"></i><b>2.5</b> HILDA</a><ul>
<li class="chapter" data-level="2.5.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-4"><i class="fa fa-check"></i><b>2.5.1</b> Load Data</a></li>
<li class="chapter" data-level="2.5.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-3"><i class="fa fa-check"></i><b>2.5.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.5.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-3"><i class="fa fa-check"></i><b>2.5.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.5.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-4"><i class="fa fa-check"></i><b>2.5.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.5.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-3"><i class="fa fa-check"></i><b>2.5.5</b> Covariates</a></li>
<li class="chapter" data-level="2.5.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-3"><i class="fa fa-check"></i><b>2.5.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="dataCleaning.html"><a href="dataCleaning.html#hrs"><i class="fa fa-check"></i><b>2.6</b> HRS</a><ul>
<li class="chapter" data-level="2.6.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-5"><i class="fa fa-check"></i><b>2.6.1</b> Load Data</a></li>
<li class="chapter" data-level="2.6.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-4"><i class="fa fa-check"></i><b>2.6.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.6.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-4"><i class="fa fa-check"></i><b>2.6.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.6.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-5"><i class="fa fa-check"></i><b>2.6.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.6.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-4"><i class="fa fa-check"></i><b>2.6.5</b> Covariates</a></li>
<li class="chapter" data-level="2.6.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-4"><i class="fa fa-check"></i><b>2.6.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="dataCleaning.html"><a href="dataCleaning.html#liss"><i class="fa fa-check"></i><b>2.7</b> LISS</a><ul>
<li class="chapter" data-level="2.7.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-6"><i class="fa fa-check"></i><b>2.7.1</b> Load Data</a></li>
<li class="chapter" data-level="2.7.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-5"><i class="fa fa-check"></i><b>2.7.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.7.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-5"><i class="fa fa-check"></i><b>2.7.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.7.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-6"><i class="fa fa-check"></i><b>2.7.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.7.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-5"><i class="fa fa-check"></i><b>2.7.5</b> Covariates</a></li>
<li class="chapter" data-level="2.7.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-5"><i class="fa fa-check"></i><b>2.7.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.8" data-path="dataCleaning.html"><a href="dataCleaning.html#midus"><i class="fa fa-check"></i><b>2.8</b> MIDUS</a><ul>
<li class="chapter" data-level="2.8.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-7"><i class="fa fa-check"></i><b>2.8.1</b> Load Data</a></li>
<li class="chapter" data-level="2.8.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-6"><i class="fa fa-check"></i><b>2.8.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.8.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-6"><i class="fa fa-check"></i><b>2.8.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.8.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-7"><i class="fa fa-check"></i><b>2.8.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.8.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-6"><i class="fa fa-check"></i><b>2.8.5</b> Covariates</a></li>
<li class="chapter" data-level="2.8.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-6"><i class="fa fa-check"></i><b>2.8.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="dataCleaning.html"><a href="dataCleaning.html#nlsy"><i class="fa fa-check"></i><b>2.9</b> NLSY</a><ul>
<li class="chapter" data-level="2.9.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-8"><i class="fa fa-check"></i><b>2.9.1</b> Load Data</a></li>
<li class="chapter" data-level="2.9.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-7"><i class="fa fa-check"></i><b>2.9.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.9.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-7"><i class="fa fa-check"></i><b>2.9.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.9.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-8"><i class="fa fa-check"></i><b>2.9.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.9.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-7"><i class="fa fa-check"></i><b>2.9.5</b> Covariates</a></li>
<li class="chapter" data-level="2.9.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-7"><i class="fa fa-check"></i><b>2.9.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="dataCleaning.html"><a href="dataCleaning.html#shp"><i class="fa fa-check"></i><b>2.10</b> SHP</a><ul>
<li class="chapter" data-level="2.10.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-9"><i class="fa fa-check"></i><b>2.10.1</b> Load Data</a></li>
<li class="chapter" data-level="2.10.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-8"><i class="fa fa-check"></i><b>2.10.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.10.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-8"><i class="fa fa-check"></i><b>2.10.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.10.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-9"><i class="fa fa-check"></i><b>2.10.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.10.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-8"><i class="fa fa-check"></i><b>2.10.5</b> Covariates</a></li>
<li class="chapter" data-level="2.10.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-8"><i class="fa fa-check"></i><b>2.10.6</b> Imputation</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="dataCleaning.html"><a href="dataCleaning.html#wls"><i class="fa fa-check"></i><b>2.11</b> WLS</a><ul>
<li class="chapter" data-level="2.11.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data-10"><i class="fa fa-check"></i><b>2.11.1</b> Load Data</a></li>
<li class="chapter" data-level="2.11.2" data-path="dataCleaning.html"><a href="dataCleaning.html#matching-variables-9"><i class="fa fa-check"></i><b>2.11.2</b> Matching Variables</a></li>
<li class="chapter" data-level="2.11.3" data-path="dataCleaning.html"><a href="dataCleaning.html#personality-variables-9"><i class="fa fa-check"></i><b>2.11.3</b> Personality Variables</a></li>
<li class="chapter" data-level="2.11.4" data-path="dataCleaning.html"><a href="dataCleaning.html#outcome-variables-10"><i class="fa fa-check"></i><b>2.11.4</b> Outcome Variables</a></li>
<li class="chapter" data-level="2.11.5" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates-9"><i class="fa fa-check"></i><b>2.11.5</b> Covariates</a></li>
<li class="chapter" data-level="2.11.6" data-path="dataCleaning.html"><a href="dataCleaning.html#imputation-9"><i class="fa fa-check"></i><b>2.11.6</b> Imputation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html"><i class="fa fa-check"></i><b>3</b> Propensity Score Matching {PSM}</a><ul>
<li class="chapter" data-level="3.1" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#part-1-data"><i class="fa fa-check"></i><b>3.1</b> Part 1: Data</a><ul>
<li class="chapter" data-level="3.1.1" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#outcomes-and-personality"><i class="fa fa-check"></i><b>3.1.1</b> Outcomes and Personality</a></li>
<li class="chapter" data-level="3.1.2" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#combine-matching-and-outcome-variables"><i class="fa fa-check"></i><b>3.1.2</b> Combine Matching and Outcome Variables</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#part-2-run-matching"><i class="fa fa-check"></i><b>3.2</b> Part 2: Run Matching</a><ul>
<li class="chapter" data-level="3.2.1" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#run-models"><i class="fa fa-check"></i><b>3.2.1</b> Run Models</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#part-3-balance"><i class="fa fa-check"></i><b>3.3</b> Part 3: Balance</a><ul>
<li class="chapter" data-level="3.3.1" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#run"><i class="fa fa-check"></i><b>3.3.1</b> Run</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="propensity-score-matching-psm.html"><a href="propensity-score-matching-psm.html#part-4-descriptives"><i class="fa fa-check"></i><b>3.4</b> Part 4: Descriptives</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html"><i class="fa fa-check"></i><b>4</b> PSM Models {PSM Mods}</a><ul>
<li class="chapter" data-level="4.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#part-5-data-setup"><i class="fa fa-check"></i><b>4.1</b> Part 5: Data Setup</a><ul>
<li class="chapter" data-level="4.1.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#personality"><i class="fa fa-check"></i><b>4.1.1</b> Personality</a></li>
<li class="chapter" data-level="4.1.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#moderators"><i class="fa fa-check"></i><b>4.1.2</b> Moderators</a></li>
<li class="chapter" data-level="4.1.3" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#outcomes"><i class="fa fa-check"></i><b>4.1.3</b> Outcomes</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#part-6-models"><i class="fa fa-check"></i><b>4.2</b> Part 6: Models</a><ul>
<li class="chapter" data-level="4.2.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#matched-model-function"><i class="fa fa-check"></i><b>4.2.1</b> Matched Model Function</a></li>
<li class="chapter" data-level="4.2.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#setup-cluster-jobs"><i class="fa fa-check"></i><b>4.2.2</b> Setup Cluster Jobs</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#part-7-compile-cluster-jobs"><i class="fa fa-check"></i><b>4.3</b> Part 7: Compile Cluster Jobs</a><ul>
<li class="chapter" data-level="4.3.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#moderator-predicted-values"><i class="fa fa-check"></i><b>4.3.1</b> Moderator Predicted Values</a></li>
<li class="chapter" data-level="4.3.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#compilation-and-summary-function"><i class="fa fa-check"></i><b>4.3.2</b> Compilation and Summary Function</a></li>
<li class="chapter" data-level="4.3.3" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#run-compilation"><i class="fa fa-check"></i><b>4.3.3</b> Run Compilation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#part-8-tables-and-plots"><i class="fa fa-check"></i><b>4.4</b> Part 8: Tables and Plots</a><ul>
<li class="chapter" data-level="4.4.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#summaries"><i class="fa fa-check"></i><b>4.4.1</b> Summaries</a></li>
<li class="chapter" data-level="4.4.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#variance-covariance-matrices"><i class="fa fa-check"></i><b>4.4.2</b> Variance-Covariance Matrices</a></li>
<li class="chapter" data-level="4.4.3" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#simple-effects"><i class="fa fa-check"></i><b>4.4.3</b> Simple Effects</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html"><i class="fa fa-check"></i><b>5</b> Specification Curve Analysis</a><ul>
<li class="chapter" data-level="5.1" data-path="dataCleaning.html"><a href="dataCleaning.html#load-data"><i class="fa fa-check"></i><b>5.1</b> Load Data</a><ul>
<li class="chapter" data-level="5.1.1" data-path="dataCleaning.html"><a href="dataCleaning.html#covariates"><i class="fa fa-check"></i><b>5.1.1</b> Covariates</a></li>
<li class="chapter" data-level="5.1.2" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#outcomes"><i class="fa fa-check"></i><b>5.1.2</b> Outcomes</a></li>
<li class="chapter" data-level="5.1.3" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#personality"><i class="fa fa-check"></i><b>5.1.3</b> Personality</a></li>
<li class="chapter" data-level="5.1.4" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#moderators"><i class="fa fa-check"></i><b>5.1.4</b> Moderators</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#sca-data-setup"><i class="fa fa-check"></i><b>5.2</b> SCA Data Setup</a></li>
<li class="chapter" data-level="5.3" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#functions"><i class="fa fa-check"></i><b>5.3</b> Functions</a><ul>
<li class="chapter" data-level="5.3.1" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#permutation-samples"><i class="fa fa-check"></i><b>5.3.1</b> Permutation Samples</a></li>
<li class="chapter" data-level="5.3.2" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#permutation-models"><i class="fa fa-check"></i><b>5.3.2</b> Permutation Models</a></li>
<li class="chapter" data-level="5.3.3" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#terms-and-formulas"><i class="fa fa-check"></i><b>5.3.3</b> Terms and Formulas</a></li>
<li class="chapter" data-level="5.3.4" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#full-models-and-workspace-setup"><i class="fa fa-check"></i><b>5.3.4</b> Full Models and Workspace Setup</a></li>
<li class="chapter" data-level="5.3.5" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#specifications-and-permutations-for-cluster"><i class="fa fa-check"></i><b>5.3.5</b> Specifications and Permutations for Cluster</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#setup"><i class="fa fa-check"></i><b>5.4</b> Setup</a><ul>
<li class="chapter" data-level="5.4.1" data-path="index.html"><a href="index.html#workspace"><i class="fa fa-check"></i><b>5.4.1</b> Workspace</a></li>
<li class="chapter" data-level="5.4.2" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#job-arrays-for-the-cluster"><i class="fa fa-check"></i><b>5.4.2</b> Job Arrays for the Cluster</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#re-compiling"><i class="fa fa-check"></i><b>5.5</b> Re-Compiling</a><ul>
<li class="chapter" data-level="5.5.1" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#raw-data-functions"><i class="fa fa-check"></i><b>5.5.1</b> Raw Data Functions</a></li>
<li class="chapter" data-level="5.5.2" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#perm-data-functions"><i class="fa fa-check"></i><b>5.5.2</b> Perm Data Functions</a></li>
<li class="chapter" data-level="5.5.3" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#inferential-based-tests"><i class="fa fa-check"></i><b>5.5.3</b> Inferential-Based Tests</a></li>
<li class="chapter" data-level="5.5.4" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#plotting-function"><i class="fa fa-check"></i><b>5.5.4</b> Plotting Function</a></li>
<li class="chapter" data-level="5.5.5" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#compiling-function"><i class="fa fa-check"></i><b>5.5.5</b> Compiling Function</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="specification-curve-analysis.html"><a href="specification-curve-analysis.html#results"><i class="fa fa-check"></i><b>5.6</b> Results</a><ul>
<li class="chapter" data-level="5.6.1" data-path="psm-models-psm-mods.html"><a href="psm-models-psm-mods.html#tables"><i class="fa fa-check"></i><b>5.6.1</b> Tables</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Mega-Analysis of Personality Predictions: Robustness and Boundary Conditions</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="psm-models-psm-mods" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> PSM Models {PSM Mods}</h1>
<p>Now that the propensity score matching procedure and balance has run, we can set up the final data sets, run the models, recompile across imputations, and create the tables and figures.</p>
<div id="part-5-data-setup" class="section level2">
<h2><span class="header-section-number">4.1</span> Part 5: Data Setup</h2>
<div id="personality" class="section level3">
<h3><span class="header-section-number">4.1.1</span> Personality</h3>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" data-line-number="1">loadRData &lt;-<span class="st"> </span><span class="cf">function</span>(fileName, type){</a>
<a class="sourceLine" id="cb186-2" data-line-number="2"><span class="co">#loads an RData file, and returns it</span></a>
<a class="sourceLine" id="cb186-3" data-line-number="3">    path &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;%s/data/clean/%s_cleaned.RData&quot;</span>, wd, fileName)</a>
<a class="sourceLine" id="cb186-4" data-line-number="4">    <span class="kw">load</span>(path)</a>
<a class="sourceLine" id="cb186-5" data-line-number="5">    <span class="kw">get</span>(<span class="kw">ls</span>()[<span class="kw">grepl</span>(type, <span class="kw">ls</span>())])</a>
<a class="sourceLine" id="cb186-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb186-7" data-line-number="7"></a>
<a class="sourceLine" id="cb186-8" data-line-number="8">psm_pers &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">study =</span> studies) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(study, <span class="op">~</span><span class="kw">loadRData</span>(., <span class="st">&quot;pers&quot;</span>)),</a>
<a class="sourceLine" id="cb186-10" data-line-number="10">         <span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.numeric</span>(year), <span class="dt">SID =</span> <span class="kw">as.character</span>(SID))),</a>
<a class="sourceLine" id="cb186-11" data-line-number="11">         <span class="dt">study =</span> <span class="kw">mapvalues</span>(study, studies, studies_long)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-12" data-line-number="12"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(name) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-14" data-line-number="14"><span class="st">  </span><span class="kw">full_join</span>(p_waves <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">study =</span> Study, <span class="dt">name =</span> p_item, Used)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-15" data-line-number="15"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>Used) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-16" data-line-number="16"><span class="st">  </span><span class="kw">select</span>(study<span class="op">:</span>value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb186-17" data-line-number="17"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Trait =</span> name, <span class="dt">p_value =</span> value)</a>
<a class="sourceLine" id="cb186-18" data-line-number="18">psm_pers</a></code></pre></div>
</div>
<div id="moderators" class="section level3">
<h3><span class="header-section-number">4.1.2</span> Moderators</h3>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1">mod_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">study =</span> studies) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(study, <span class="op">~</span><span class="kw">loadRData</span>(., <span class="st">&quot;alpha&quot;</span>)),</a>
<a class="sourceLine" id="cb187-3" data-line-number="3">         <span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">year =</span> <span class="kw">as.numeric</span>(year))),</a>
<a class="sourceLine" id="cb187-4" data-line-number="4">         <span class="dt">study =</span> <span class="kw">mapvalues</span>(study, studies, studies_long)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-5" data-line-number="5"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">alpha =</span> <span class="kw">map</span>(alpha, <span class="kw">possibly</span>(<span class="op">~</span>(.)<span class="op">$</span>total[[<span class="dv">1</span>]], <span class="ot">NA_real_</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb187-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(study, <span class="dt">p_item =</span> name, year, alpha) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-9" data-line-number="9"><span class="st">  </span><span class="kw">unnest</span>(alpha) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb187-10" data-line-number="10"><span class="st">  </span><span class="kw">full_join</span>(p_waves <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(p_item, <span class="dt">study =</span> Study, Used, predInt)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span>Used) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb187-12" data-line-number="12"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Used) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-13" data-line-number="13"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Trait =</span> p_item, <span class="dt">reliability =</span> alpha)</a>
<a class="sourceLine" id="cb187-14" data-line-number="14"></a>
<a class="sourceLine" id="cb187-15" data-line-number="15">mod_data &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">study =</span> studies) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-16" data-line-number="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(study, <span class="op">~</span><span class="kw">loadRData</span>(., <span class="st">&quot;SCA&quot;</span>)),</a>
<a class="sourceLine" id="cb187-17" data-line-number="17">         <span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">p_year =</span> <span class="kw">as.numeric</span>(p_year), <span class="dt">SID=</span><span class="kw">as.character</span>(SID)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SID, <span class="dt">year =</span> p_year, age, gender, <span class="kw">one_of</span>(<span class="kw">c</span>(<span class="st">&quot;parEdu&quot;</span>, <span class="st">&quot;grsWages&quot;</span>, <span class="st">&quot;parOccPrstg&quot;</span>, <span class="st">&quot;race&quot;</span>)))),</a>
<a class="sourceLine" id="cb187-18" data-line-number="18">         <span class="dt">study =</span> <span class="kw">mapvalues</span>(study, studies, studies_long)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-19" data-line-number="19"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb187-20" data-line-number="20"><span class="st">  </span><span class="kw">full_join</span>(mod_data)</a>
<a class="sourceLine" id="cb187-21" data-line-number="21">mod_data</a></code></pre></div>
</div>
<div id="outcomes" class="section level3">
<h3><span class="header-section-number">4.1.3</span> Outcomes</h3>
<div id="matched" class="section level4">
<h4><span class="header-section-number">4.1.3.1</span> Matched</h4>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" data-line-number="1">factor_fun &lt;-<span class="st"> </span><span class="cf">function</span>(x){<span class="cf">if</span>(<span class="kw">is.numeric</span>(x)){<span class="kw">diff</span>(<span class="kw">range</span>(x, <span class="dt">na.rm =</span> T)) <span class="op">%in%</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>} <span class="cf">else</span>{F}}</a>
<a class="sourceLine" id="cb188-2" data-line-number="2"></a>
<a class="sourceLine" id="cb188-3" data-line-number="3">read_fun &lt;-<span class="st"> </span><span class="cf">function</span>(file){</a>
<a class="sourceLine" id="cb188-4" data-line-number="4">  <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/data/psm_matched/%s&quot;</span>, wd, file))</a>
<a class="sourceLine" id="cb188-5" data-line-number="5">  d <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(SID, o_value) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">o_value =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(o_value)),</a>
<a class="sourceLine" id="cb188-7" data-line-number="7">           <span class="dt">o_value =</span> <span class="kw">ifelse</span>(o_value <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>, <span class="dv">1</span>, o_value))</a>
<a class="sourceLine" id="cb188-8" data-line-number="8">}  </a>
<a class="sourceLine" id="cb188-9" data-line-number="9"></a>
<a class="sourceLine" id="cb188-10" data-line-number="10">merge_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df3, Study, df){</a>
<a class="sourceLine" id="cb188-11" data-line-number="11">  df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(study <span class="op">==</span><span class="st"> </span>Study) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-12" data-line-number="12"><span class="st">    </span><span class="kw">full_join</span>(df3) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>study) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-13" data-line-number="13"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(o_value) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(p_value)) </a>
<a class="sourceLine" id="cb188-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb188-15" data-line-number="15"></a>
<a class="sourceLine" id="cb188-16" data-line-number="16">combine_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df2, outcome, mod, trait, df){</a>
<a class="sourceLine" id="cb188-17" data-line-number="17">  <span class="co"># plan(multisession)</span></a>
<a class="sourceLine" id="cb188-18" data-line-number="18">  df_l &lt;-<span class="st"> </span>df2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-19" data-line-number="19"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(file, read_fun),</a>
<a class="sourceLine" id="cb188-20" data-line-number="20">           <span class="dt">data =</span> <span class="kw">pmap</span>(<span class="kw">list</span>(<span class="dt">df3 =</span> data, <span class="dt">Study =</span> study, <span class="dt">df =</span> <span class="kw">list</span>(df)), merge_fun)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-21" data-line-number="21"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>file, <span class="op">-</span>year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-22" data-line-number="22"><span class="st">    </span><span class="kw">group_by</span>(imp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-23" data-line-number="23"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-24" data-line-number="24"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-25" data-line-number="25"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(data)),</a>
<a class="sourceLine" id="cb188-26" data-line-number="26">           <span class="dt">data =</span> <span class="kw">map</span>(data, clean_fun))</a>
<a class="sourceLine" id="cb188-27" data-line-number="27">  df_l &lt;-<span class="st"> </span>df_l<span class="op">$</span>data</a>
<a class="sourceLine" id="cb188-28" data-line-number="28">  <span class="kw">save</span>(df_l, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/data/psm_combined/%s_%s_%s.RData&quot;</span>, wd, outcome, trait, mod))</a>
<a class="sourceLine" id="cb188-29" data-line-number="29">  <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">&quot;df2&quot;</span>, <span class="st">&quot;df_l&quot;</span>))</a>
<a class="sourceLine" id="cb188-30" data-line-number="30">  <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb188-31" data-line-number="31">}</a>
<a class="sourceLine" id="cb188-32" data-line-number="32"></a>
<a class="sourceLine" id="cb188-33" data-line-number="33">clean_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df4){</a>
<a class="sourceLine" id="cb188-34" data-line-number="34">  df4 &lt;-<span class="st"> </span>df4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb188-35" data-line-number="35"><span class="st">    </span><span class="kw">mutate_if</span>(factor_fun, as.factor) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-36" data-line-number="36"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">o_value =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(o_value))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-37" data-line-number="37"><span class="st">    </span><span class="kw">group_by</span>(study) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-38" data-line-number="38"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(p_value, parOccPrstg, grsWages), </a>
<a class="sourceLine" id="cb188-39" data-line-number="39">            <span class="op">~</span>((. <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(., <span class="dt">na.rm =</span> T))<span class="op">/</span>(<span class="kw">max</span>(., <span class="dt">na.rm =</span> T) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(., <span class="dt">na.rm =</span> T))<span class="op">*</span><span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-40" data-line-number="40"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">age =</span> <span class="kw">scale</span>(age, <span class="dt">center =</span> T, <span class="dt">scale =</span> F)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-41" data-line-number="41"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-42" data-line-number="42"><span class="st">    </span><span class="kw">mutate_if</span>(is.numeric, <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">is.infinite</span>(.), <span class="ot">NA</span>, .)) </a>
<a class="sourceLine" id="cb188-43" data-line-number="43">  </a>
<a class="sourceLine" id="cb188-44" data-line-number="44">  std &lt;-<span class="st"> </span>df4 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-45" data-line-number="45"><span class="st">        </span><span class="kw">group_by</span>(study, o_value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-46" data-line-number="46"><span class="st">        </span><span class="kw">tally</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-47" data-line-number="47"><span class="st">        </span><span class="kw">full_join</span>(<span class="kw">crossing</span>(<span class="dt">study =</span> <span class="kw">unique</span>(.<span class="op">$</span>study), <span class="dt">o_value =</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb188-48" data-line-number="48">  std &lt;-<span class="st"> </span><span class="kw">unique</span>(std<span class="op">$</span>study[std<span class="op">$</span>n <span class="op">&lt;</span><span class="st"> </span><span class="dv">8</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(std<span class="op">$</span>n)])</a>
<a class="sourceLine" id="cb188-49" data-line-number="49">  df4 &lt;-<span class="st"> </span>df4 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-50" data-line-number="50"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span>study <span class="op">%in%</span><span class="st"> </span>std) </a>
<a class="sourceLine" id="cb188-51" data-line-number="51">}</a>
<a class="sourceLine" id="cb188-52" data-line-number="52"></a>
<a class="sourceLine" id="cb188-53" data-line-number="53"></a>
<a class="sourceLine" id="cb188-54" data-line-number="54">out_data_fun &lt;-<span class="st"> </span><span class="cf">function</span>(trait, df){</a>
<a class="sourceLine" id="cb188-55" data-line-number="55">  <span class="kw">print</span>(trait)</a>
<a class="sourceLine" id="cb188-56" data-line-number="56">  <span class="kw">plan</span>(<span class="kw">multisession</span>(<span class="dt">workers =</span> 6L))</a>
<a class="sourceLine" id="cb188-57" data-line-number="57">  df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(study, <span class="dt">p_year =</span> year) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-58" data-line-number="58"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">file =</span> <span class="kw">map</span>(study, <span class="op">~</span><span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/data/psm_matched&quot;</span>, wd), <span class="dt">pattern =</span> .))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-59" data-line-number="59"><span class="st">    </span><span class="kw">select</span>(<span class="op">-</span>study) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-60" data-line-number="60"><span class="st">    </span><span class="kw">unnest</span>(file) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-61" data-line-number="61"><span class="st">    </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;study&quot;</span>,<span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;imp&quot;</span>, <span class="st">&quot;Moderator&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">remove =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-62" data-line-number="62"><span class="st">    </span><span class="kw">group_by</span>(study, Trait, Outcome, year, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-63" data-line-number="63"><span class="st">    </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-64" data-line-number="64"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-65" data-line-number="65"><span class="st">    </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Moderator)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-66" data-line-number="66"><span class="st">    </span><span class="kw">filter</span>(Outcome <span class="op">==</span><span class="st"> &quot;retired&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-67" data-line-number="67"><span class="st">    </span><span class="kw">filter</span>(p_year <span class="op">==</span><span class="st"> </span>year <span class="op">&amp;</span><span class="st"> </span>Trait <span class="op">==</span><span class="st"> </span>trait) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>p_year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-68" data-line-number="68"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Moderator =</span> <span class="kw">str_remove_all</span>(Moderator, <span class="st">&quot;.RData&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-69" data-line-number="69"><span class="st">    </span><span class="kw">group_by</span>(Moderator, Outcome, Trait) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-70" data-line-number="70"><span class="st">    </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-71" data-line-number="71"><span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-72" data-line-number="72"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">future_pmap</span>(</a>
<a class="sourceLine" id="cb188-73" data-line-number="73">      <span class="kw">list</span>(<span class="dt">df2 =</span> data, <span class="dt">outcome =</span> Outcome, <span class="dt">mod =</span> Moderator, <span class="dt">trait =</span> Trait, <span class="dt">df =</span> <span class="kw">list</span>(df))</a>
<a class="sourceLine" id="cb188-74" data-line-number="74">      , combine_fun</a>
<a class="sourceLine" id="cb188-75" data-line-number="75">      , <span class="dt">.options =</span> <span class="kw">future_options</span>(</a>
<a class="sourceLine" id="cb188-76" data-line-number="76">        <span class="dt">globals =</span> <span class="kw">c</span>(<span class="st">&quot;clean_fun&quot;</span>, <span class="st">&quot;combine_fun&quot;</span>, <span class="st">&quot;factor_fun&quot;</span>,</a>
<a class="sourceLine" id="cb188-77" data-line-number="77">                    <span class="st">&quot;loadRData&quot;</span>, <span class="st">&quot;merge_fun&quot;</span>, <span class="st">&quot;read_fun&quot;</span>,<span class="st">&quot;wd&quot;</span>)</a>
<a class="sourceLine" id="cb188-78" data-line-number="78">        , <span class="dt">packages =</span> <span class="kw">c</span>(<span class="st">&quot;plyr&quot;</span>, <span class="st">&quot;tidyverse&quot;</span>))))</a>
<a class="sourceLine" id="cb188-79" data-line-number="79">  <span class="kw">closeAllConnections</span>()</a>
<a class="sourceLine" id="cb188-80" data-line-number="80">  <span class="kw">return</span>(T)</a>
<a class="sourceLine" id="cb188-81" data-line-number="81">}</a>
<a class="sourceLine" id="cb188-82" data-line-number="82"><span class="co"># plan(multisession(workers = 5L))</span></a>
<a class="sourceLine" id="cb188-83" data-line-number="83">psm_data &lt;-<span class="st"> </span>psm_pers <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-84" data-line-number="84"><span class="st">  </span><span class="kw">full_join</span>(mod_data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-85" data-line-number="85"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(p_value) <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(Trait)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-86" data-line-number="86"><span class="st">  </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-87" data-line-number="87"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-88" data-line-number="88"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-89" data-line-number="89"><span class="st">  </span><span class="kw">filter</span>(Trait <span class="op">==</span><span class="st"> &quot;LOC&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb188-90" data-line-number="90"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map2</span>(Trait, data, out_data_fun))</a>
<a class="sourceLine" id="cb188-91" data-line-number="91"><span class="kw">closeAllConnections</span>()</a></code></pre></div>
</div>
</div>
</div>
<div id="part-6-models" class="section level2">
<h2><span class="header-section-number">4.2</span> Part 6: Models</h2>
<div id="matched-model-function" class="section level3">
<h3><span class="header-section-number">4.2.1</span> Matched Model Function</h3>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1">brms_matched_fun &lt;-<span class="st"> </span><span class="cf">function</span>(outcome, trait, mod){</a>
<a class="sourceLine" id="cb189-2" data-line-number="2">  <span class="co"># load data </span></a>
<a class="sourceLine" id="cb189-3" data-line-number="3">  m &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;SES&quot;</span>) <span class="kw">c</span>(<span class="st">&quot;parEdu&quot;</span>, <span class="st">&quot;grsWages&quot;</span>, <span class="st">&quot;parOccPrstg&quot;</span>)  <span class="cf">else</span> mod</a>
<a class="sourceLine" id="cb189-4" data-line-number="4">  d &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>)){<span class="st">&quot;none&quot;</span>} <span class="cf">else</span> mod</a>
<a class="sourceLine" id="cb189-5" data-line-number="5">  <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/data/psm_combined/%s_%s_%s.RData&quot;</span>, wd, outcome, trait, d))</a>
<a class="sourceLine" id="cb189-6" data-line-number="6">  </a>
<a class="sourceLine" id="cb189-7" data-line-number="7">  df_l &lt;-<span class="st"> </span><span class="kw">map</span>(df_l, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(study, SID, p_value, o_value, <span class="kw">one_of</span>(d)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-8" data-line-number="8"><span class="st">                </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.)))</a>
<a class="sourceLine" id="cb189-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb189-10" data-line-number="10">  <span class="co"># set priors</span></a>
<a class="sourceLine" id="cb189-11" data-line-number="11">  Prior &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="kw">set_prior</span>(<span class="st">&quot;cauchy(0,1)&quot;</span>, <span class="dt">class =</span> <span class="st">&quot;sd&quot;</span>))</a>
<a class="sourceLine" id="cb189-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb189-13" data-line-number="13">  <span class="co"># formula </span></a>
<a class="sourceLine" id="cb189-14" data-line-number="14">  <span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){f &lt;-<span class="st"> </span><span class="kw">formula</span>(o_value <span class="op">~</span><span class="st"> </span>p_value <span class="op">+</span><span class="st"> </span>(p_value <span class="op">|</span><span class="st"> </span>study))}</a>
<a class="sourceLine" id="cb189-15" data-line-number="15">  <span class="cf">else</span> <span class="cf">if</span>(mod <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>)){f &lt;-<span class="st"> </span><span class="kw">formula</span>(<span class="kw">paste</span>(<span class="st">&quot;o_value ~ p_value + &quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;p_value*&quot;</span>, m, <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>), <span class="st">&quot; + (p_value | study)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))}</a>
<a class="sourceLine" id="cb189-16" data-line-number="16">  <span class="cf">else</span> {f &lt;-<span class="st"> </span><span class="kw">formula</span>(<span class="kw">paste</span>(<span class="st">&quot;o_value ~ p_value + &quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;p_value*&quot;</span>, m, <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>), <span class="st">&quot;+ (&quot;</span>, <span class="kw">paste</span>(<span class="st">&quot;p_value*&quot;</span>, m, <span class="dt">collapse =</span> <span class="st">&quot; + &quot;</span>), <span class="st">&quot; | study)&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>))}</a>
<a class="sourceLine" id="cb189-17" data-line-number="17">  <span class="co"># run the model </span></a>
<a class="sourceLine" id="cb189-18" data-line-number="18">  Iter &lt;-<span class="st"> </span><span class="dv">2000</span>; Warmup &lt;-<span class="st"> </span><span class="dv">1000</span>; treedepth &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb189-19" data-line-number="19">  </a>
<a class="sourceLine" id="cb189-20" data-line-number="20">  start.tmp &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()</a>
<a class="sourceLine" id="cb189-21" data-line-number="21">  fit2 &lt;-<span class="st"> </span><span class="kw">brm_multiple</span>(<span class="dt">formula =</span> f</a>
<a class="sourceLine" id="cb189-22" data-line-number="22">             , <span class="dt">data =</span> df_l</a>
<a class="sourceLine" id="cb189-23" data-line-number="23">             , <span class="dt">prior =</span> Prior</a>
<a class="sourceLine" id="cb189-24" data-line-number="24">             , <span class="dt">iter =</span> Iter</a>
<a class="sourceLine" id="cb189-25" data-line-number="25">             , <span class="dt">warmup =</span> Warmup</a>
<a class="sourceLine" id="cb189-26" data-line-number="26">             , <span class="dt">family =</span> <span class="kw">binomial</span>(<span class="dt">link =</span> <span class="st">&quot;logit&quot;</span>)</a>
<a class="sourceLine" id="cb189-27" data-line-number="27">             , <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta =</span> <span class="fl">0.99</span>, <span class="dt">max_treedepth =</span> treedepth)</a>
<a class="sourceLine" id="cb189-28" data-line-number="28">             , <span class="dt">cores =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb189-29" data-line-number="29">  <span class="kw">print</span>(end.tmp &lt;-<span class="st"> </span><span class="kw">Sys.time</span>() <span class="op">-</span><span class="st"> </span>start.tmp)</a>
<a class="sourceLine" id="cb189-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb189-31" data-line-number="31">  <span class="co"># extract key parameters</span></a>
<a class="sourceLine" id="cb189-32" data-line-number="32">  <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb189-33" data-line-number="33">  fx &lt;-<span class="st"> </span><span class="kw">fixef</span>(fit, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="op">%&gt;%</span><span class="st"> </span>data.frame <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-34" data-line-number="34"><span class="st">    </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;names&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-35" data-line-number="35"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>names), <span class="kw">lst</span>(<span class="dt">OR =</span> inv_logit_scaled)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-36" data-line-number="36"><span class="st">    </span>as_tibble </a>
<a class="sourceLine" id="cb189-37" data-line-number="37">  <span class="co"># random effects</span></a>
<a class="sourceLine" id="cb189-38" data-line-number="38">  rx &lt;-<span class="st"> </span><span class="kw">ranef</span>(fit, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>))[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">array_tree</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-39" data-line-number="39"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">names =</span> <span class="kw">names</span>(.), <span class="dt">data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-40" data-line-number="40"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span>data.frame <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-41" data-line-number="41"><span class="st">      </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;study&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-42" data-line-number="42"><span class="st">    </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-43" data-line-number="43"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>names, <span class="op">-</span>study), <span class="kw">lst</span>(<span class="dt">OR =</span> inv_logit_scaled)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-44" data-line-number="44"><span class="st">    </span>as_tibble</a>
<a class="sourceLine" id="cb189-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb189-46" data-line-number="46">  </a>
<a class="sourceLine" id="cb189-47" data-line-number="47">  </a>
<a class="sourceLine" id="cb189-48" data-line-number="48">  <span class="co"># samples</span></a>
<a class="sourceLine" id="cb189-49" data-line-number="49">  fx.draws &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy_draws</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-50" data-line-number="50"><span class="st">    </span><span class="kw">select</span>(.chain<span class="op">:</span>.draw, <span class="kw">matches</span>(<span class="st">&quot;^b_&quot;</span>), <span class="kw">matches</span>(<span class="st">&quot;p_value]$&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-51" data-line-number="51"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">matches</span>(<span class="st">&quot;p_value]$&quot;</span>)), <span class="op">~</span>(.) <span class="op">+</span><span class="st"> </span>b_p_value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb189-52" data-line-number="52"><span class="st">    </span><span class="kw">gather</span>(<span class="dt">key =</span> item, <span class="dt">value =</span> s_value, <span class="op">-</span>(.chain<span class="op">:</span>.draw))</a>
<a class="sourceLine" id="cb189-53" data-line-number="53">  </a>
<a class="sourceLine" id="cb189-54" data-line-number="54">  tau.draws &lt;-<span class="st"> </span>fit <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy_draws</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb189-55" data-line-number="55"><span class="st">    </span><span class="kw">select</span>(.chain<span class="op">:</span>.draw, <span class="kw">matches</span>(<span class="st">&quot;^sd&quot;</span>), <span class="kw">matches</span>(<span class="st">&quot;^cor&quot;</span>))</a>
<a class="sourceLine" id="cb189-56" data-line-number="56">  </a>
<a class="sourceLine" id="cb189-57" data-line-number="57">  <span class="cf">if</span>(mod <span class="op">!=</span><span class="st"> &quot;none&quot;</span>){</a>
<a class="sourceLine" id="cb189-58" data-line-number="58">    pred.fx &lt;-<span class="st"> </span><span class="kw">fx_pred_fun</span>(fit, m)</a>
<a class="sourceLine" id="cb189-59" data-line-number="59">    pred.rx &lt;-<span class="st"> </span><span class="kw">rx_pred_fun</span>(fit, m)</a>
<a class="sourceLine" id="cb189-60" data-line-number="60">    <span class="kw">save</span>(pred.fx, pred.rx, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;/scratch/edbeck/psm/predicted/pred_%s_%s_%s&quot;</span>, trait, outcome, mod))</a>
<a class="sourceLine" id="cb189-61" data-line-number="61">  }</a>
<a class="sourceLine" id="cb189-62" data-line-number="62">  </a>
<a class="sourceLine" id="cb189-63" data-line-number="63">  <span class="kw">save</span>(fit, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;/scratch/edbeck/psm/models/matched_%s_%s_%s&quot;</span>, trait, outcome, mod))</a>
<a class="sourceLine" id="cb189-64" data-line-number="64">  <span class="kw">save</span>(fx, rx, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;/scratch/edbeck/psm/summary/matched_%s_%s_%s&quot;</span>, trait, outcome, mod))</a>
<a class="sourceLine" id="cb189-65" data-line-number="65">  <span class="kw">save</span>(fx.draws, tau.draws, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;/scratch/edbeck/psm/draws/matched_%s_%s_%s&quot;</span>, trait, outcome, mod))</a>
<a class="sourceLine" id="cb189-66" data-line-number="66">  <span class="kw">rm</span>(<span class="kw">list</span>(<span class="st">&quot;fit&quot;</span>, <span class="st">&quot;fx&quot;</span>, <span class="st">&quot;rx&quot;</span>, <span class="st">&quot;fx.draws&quot;</span>, <span class="st">&quot;rx.draws&quot;</span>, <span class="st">&quot;df&quot;</span>))</a>
<a class="sourceLine" id="cb189-67" data-line-number="67">  <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb189-68" data-line-number="68">}</a></code></pre></div>
</div>
<div id="setup-cluster-jobs" class="section level3">
<h3><span class="header-section-number">4.2.2</span> Setup Cluster Jobs</h3>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" data-line-number="1">jobs_nested &lt;-<span class="st"> </span><span class="kw">crossing</span>(</a>
<a class="sourceLine" id="cb190-2" data-line-number="2">  <span class="dt">Trait =</span> <span class="kw">unique</span>(p_waves<span class="op">$</span>p_item), </a>
<a class="sourceLine" id="cb190-3" data-line-number="3">  <span class="dt">Outcome =</span> (codebook<span class="op">$</span>codebook[[<span class="dv">2</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(category <span class="op">==</span><span class="st"> &quot;out&quot;</span>))<span class="op">$</span>name,</a>
<a class="sourceLine" id="cb190-4" data-line-number="4">  <span class="dt">Moderator =</span> <span class="kw">c</span>(<span class="st">&quot;none&quot;</span>, <span class="st">&quot;gender&quot;</span>,<span class="st">&quot;race&quot;</span>, <span class="st">&quot;age&quot;</span>, <span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>, <span class="st">&quot;parEdu&quot;</span>, <span class="st">&quot;grsWages&quot;</span>, <span class="st">&quot;parOccPrstg&quot;</span>), </a>
<a class="sourceLine" id="cb190-5" data-line-number="5">  <span class="dt">chain =</span> <span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb190-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb190-7" data-line-number="7"></a>
<a class="sourceLine" id="cb190-8" data-line-number="8">done &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> <span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/models&quot;</span>, wd))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb190-9" data-line-number="9"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>, <span class="st">&quot;chain&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>scrap) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">done =</span> <span class="st">&quot;done&quot;</span>,</a>
<a class="sourceLine" id="cb190-12" data-line-number="12">         <span class="dt">chain =</span> <span class="kw">as.numeric</span>(<span class="kw">str_remove</span>(chain, <span class="st">&quot;.RData&quot;</span>))) </a>
<a class="sourceLine" id="cb190-13" data-line-number="13"></a>
<a class="sourceLine" id="cb190-14" data-line-number="14">jobs_nested &lt;-<span class="st"> </span>jobs_nested <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-15" data-line-number="15"><span class="st">  </span><span class="kw">full_join</span>(done) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-16" data-line-number="16"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(done)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb190-17" data-line-number="17"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>done)</a></code></pre></div>
<div id="the-cluster" class="section level4">
<h4><span class="header-section-number">4.2.2.1</span> The Cluster</h4>
</div>
</div>
</div>
<div id="part-7-compile-cluster-jobs" class="section level2">
<h2><span class="header-section-number">4.3</span> Part 7: Compile Cluster Jobs</h2>
<div id="moderator-predicted-values" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Moderator Predicted Values</h3>
<p>Below are functions to get predicted values of moderated personality-outcome associations for both fixed effects and random effects.</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="co"># fixed effect prediction function</span></a>
<a class="sourceLine" id="cb191-2" data-line-number="2">fx_pred_fun &lt;-<span class="st"> </span><span class="cf">function</span>(fits, m){</a>
<a class="sourceLine" id="cb191-3" data-line-number="3">  x &lt;-<span class="st"> </span><span class="kw">lapply</span>(m, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb191-4" data-line-number="4">  cl &lt;-<span class="st"> </span><span class="kw">class</span>(fits<span class="op">$</span>data[, x])</a>
<a class="sourceLine" id="cb191-5" data-line-number="5"></a>
<a class="sourceLine" id="cb191-6" data-line-number="6">  <span class="cf">if</span>(cl <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;matrix&quot;</span>)){</a>
<a class="sourceLine" id="cb191-7" data-line-number="7">  msd &lt;-<span class="st"> </span>fits<span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-8" data-line-number="8"><span class="st">    </span><span class="kw">select</span>(<span class="kw">one_of</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-9" data-line-number="9"><span class="st">    </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-10" data-line-number="10"><span class="st">    </span><span class="kw">summarize_all</span>(<span class="kw">lst</span>(mean, sd))</a>
<a class="sourceLine" id="cb191-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb191-12" data-line-number="12">  pred.fx &lt;-<span class="st"> </span><span class="kw">crossing</span>(</a>
<a class="sourceLine" id="cb191-13" data-line-number="13">    <span class="dt">p_value =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb191-14" data-line-number="14">    , <span class="dt">mod_value =</span> <span class="kw">with</span>(msd, <span class="kw">c</span>(mean<span class="op">-</span>sd, mean,mean<span class="op">+</span>sd))</a>
<a class="sourceLine" id="cb191-15" data-line-number="15">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-16" data-line-number="16"><span class="st">    </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;p_value&quot;</span>, x))</a>
<a class="sourceLine" id="cb191-17" data-line-number="17">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb191-18" data-line-number="18">    pred.fx &lt;-<span class="st"> </span><span class="kw">crossing</span>(</a>
<a class="sourceLine" id="cb191-19" data-line-number="19">      <span class="dt">p_value =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb191-20" data-line-number="20">      , <span class="dt">mod_value =</span> <span class="kw">factor</span>(<span class="kw">levels</span>(fits<span class="op">$</span>data[, x]))</a>
<a class="sourceLine" id="cb191-21" data-line-number="21">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-22" data-line-number="22"><span class="st">    </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;p_value&quot;</span>, x))</a>
<a class="sourceLine" id="cb191-23" data-line-number="23">  }</a>
<a class="sourceLine" id="cb191-24" data-line-number="24">  })</a>
<a class="sourceLine" id="cb191-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb191-26" data-line-number="26">  pred.fx &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw">length</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)} <span class="cf">else</span> {x[[<span class="dv">1</span>]]}</a>
<a class="sourceLine" id="cb191-27" data-line-number="27">    </a>
<a class="sourceLine" id="cb191-28" data-line-number="28">  pred.fx &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb191-29" data-line-number="29">    pred.fx, </a>
<a class="sourceLine" id="cb191-30" data-line-number="30">    <span class="kw">fitted</span>(fits</a>
<a class="sourceLine" id="cb191-31" data-line-number="31">           , <span class="dt">newdata =</span> pred.fx</a>
<a class="sourceLine" id="cb191-32" data-line-number="32">           , <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)</a>
<a class="sourceLine" id="cb191-33" data-line-number="33">           , <span class="dt">re_formula =</span> <span class="ot">NA</span></a>
<a class="sourceLine" id="cb191-34" data-line-number="34">           , <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb191-35" data-line-number="35">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-36" data-line-number="36"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="kw">lst</span>(<span class="dt">OR =</span> exp))</a>
<a class="sourceLine" id="cb191-37" data-line-number="37">}</a>
<a class="sourceLine" id="cb191-38" data-line-number="38"></a>
<a class="sourceLine" id="cb191-39" data-line-number="39"><span class="co"># short function  to get crossings of continuous personality and moderator levels</span></a>
<a class="sourceLine" id="cb191-40" data-line-number="40">crossing_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, mod){</a>
<a class="sourceLine" id="cb191-41" data-line-number="41">  pred.rx &lt;-<span class="st"> </span><span class="kw">crossing</span>(</a>
<a class="sourceLine" id="cb191-42" data-line-number="42">    <span class="dt">p_value =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,.<span class="dv">25</span>),</a>
<a class="sourceLine" id="cb191-43" data-line-number="43">    <span class="dt">mod_value =</span> <span class="kw">with</span>(df, <span class="kw">c</span>(mean<span class="op">-</span>sd, mean,mean<span class="op">+</span>sd))</a>
<a class="sourceLine" id="cb191-44" data-line-number="44">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-45" data-line-number="45"><span class="st">    </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;p_value&quot;</span>, mod))</a>
<a class="sourceLine" id="cb191-46" data-line-number="46">  <span class="kw">return</span>(pred.rx)</a>
<a class="sourceLine" id="cb191-47" data-line-number="47">}</a>
<a class="sourceLine" id="cb191-48" data-line-number="48"></a>
<a class="sourceLine" id="cb191-49" data-line-number="49"><span class="co"># function to get predicted values across random effects (studies)</span></a>
<a class="sourceLine" id="cb191-50" data-line-number="50">rx_pred_fun &lt;-<span class="st"> </span><span class="cf">function</span>(fits, m){</a>
<a class="sourceLine" id="cb191-51" data-line-number="51">  studies &lt;-<span class="st"> </span><span class="kw">unique</span>(fits<span class="op">$</span>data<span class="op">$</span>study)</a>
<a class="sourceLine" id="cb191-52" data-line-number="52">  x &lt;-<span class="st"> </span><span class="kw">lapply</span>(m, <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb191-53" data-line-number="53">   cl &lt;-<span class="st"> </span><span class="kw">class</span>(fits<span class="op">$</span>data[, x])</a>
<a class="sourceLine" id="cb191-54" data-line-number="54">  </a>
<a class="sourceLine" id="cb191-55" data-line-number="55">  <span class="cf">if</span>(cl <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;numeric&quot;</span>, <span class="st">&quot;integer&quot;</span>, <span class="st">&quot;matrix&quot;</span>)){</a>
<a class="sourceLine" id="cb191-56" data-line-number="56">    pred.rx &lt;-<span class="st"> </span>fits<span class="op">$</span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(study, <span class="kw">one_of</span>(x)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb191-57" data-line-number="57"><span class="st">      </span><span class="kw">as_tibble</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-58" data-line-number="58"><span class="st">      </span><span class="kw">group_by</span>(study) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-59" data-line-number="59"><span class="st">      </span><span class="kw">summarize_all</span>(<span class="kw">lst</span>(mean, sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-60" data-line-number="60"><span class="st">      </span><span class="kw">group_by</span>(study) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-61" data-line-number="61"><span class="st">      </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-62" data-line-number="62"><span class="st">      </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-63" data-line-number="63"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">map2</span>(data, x, crossing_fun)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-64" data-line-number="64"><span class="st">      </span><span class="kw">unnest</span>(pred) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-65" data-line-number="65"><span class="st">      </span><span class="kw">select</span>(<span class="op">-</span>data)</a>
<a class="sourceLine" id="cb191-66" data-line-number="66">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb191-67" data-line-number="67">    pred.rx &lt;-<span class="st"> </span><span class="kw">crossing</span>(</a>
<a class="sourceLine" id="cb191-68" data-line-number="68">      <span class="dt">study =</span> studies</a>
<a class="sourceLine" id="cb191-69" data-line-number="69">      , <span class="dt">p_value =</span> <span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,.<span class="dv">25</span>)</a>
<a class="sourceLine" id="cb191-70" data-line-number="70">      , <span class="dt">mod_value =</span> <span class="kw">factor</span>(<span class="kw">levels</span>(fits<span class="op">$</span>data[, x]))</a>
<a class="sourceLine" id="cb191-71" data-line-number="71">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-72" data-line-number="72"><span class="st">      </span><span class="kw">setNames</span>(<span class="kw">c</span>(<span class="st">&quot;study&quot;</span>, <span class="st">&quot;p_value&quot;</span>, x))</a>
<a class="sourceLine" id="cb191-73" data-line-number="73">  }</a>
<a class="sourceLine" id="cb191-74" data-line-number="74">  })</a>
<a class="sourceLine" id="cb191-75" data-line-number="75">  </a>
<a class="sourceLine" id="cb191-76" data-line-number="76">  pred.rx &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw">length</span>(x) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)} <span class="cf">else</span> {x[[<span class="dv">1</span>]]}</a>
<a class="sourceLine" id="cb191-77" data-line-number="77">  </a>
<a class="sourceLine" id="cb191-78" data-line-number="78">  pred.rx &lt;-<span class="st"> </span><span class="kw">bind_cols</span>(</a>
<a class="sourceLine" id="cb191-79" data-line-number="79">    pred.rx, </a>
<a class="sourceLine" id="cb191-80" data-line-number="80">    <span class="kw">fitted</span>(fits</a>
<a class="sourceLine" id="cb191-81" data-line-number="81">           , <span class="dt">newdata =</span> pred.rx</a>
<a class="sourceLine" id="cb191-82" data-line-number="82">           , <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)</a>
<a class="sourceLine" id="cb191-83" data-line-number="83">           , <span class="dt">scale =</span> <span class="st">&quot;linear&quot;</span></a>
<a class="sourceLine" id="cb191-84" data-line-number="84">           ) <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb191-85" data-line-number="85">    ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb191-86" data-line-number="86"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="kw">lst</span>(<span class="dt">OR =</span> exp))</a>
<a class="sourceLine" id="cb191-87" data-line-number="87">  <span class="kw">return</span>(pred.rx)</a>
<a class="sourceLine" id="cb191-88" data-line-number="88">}</a></code></pre></div>
</div>
<div id="compilation-and-summary-function" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Compilation and Summary Function</h3>
<p>Now that we have functions to get predicted values, the function below will load in each of the 5 imputations for a given trait-outcome-moderator combination, get fixed and random effects, Level 2 variances, predicted values (moderator models only), and fixed and random posterior draws.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb192-1" data-line-number="1">combine_fun &lt;-<span class="st"> </span><span class="cf">function</span>(trait, outcome, mod){</a>
<a class="sourceLine" id="cb192-2" data-line-number="2">  <span class="co"># get short moderator names</span></a>
<a class="sourceLine" id="cb192-3" data-line-number="3">  m &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;SES&quot;</span>) <span class="kw">c</span>(<span class="st">&quot;parEdu&quot;</span>, <span class="st">&quot;grsWages&quot;</span>, <span class="st">&quot;parOccPrstg&quot;</span>)  <span class="cf">else</span> mod</a>
<a class="sourceLine" id="cb192-4" data-line-number="4">  d &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>)){<span class="st">&quot;none&quot;</span>} <span class="cf">else</span> mod</a>
<a class="sourceLine" id="cb192-5" data-line-number="5">  <span class="co"># load in each of the models and change their class to both brmsfit and brmsfit_multiple</span></a>
<a class="sourceLine" id="cb192-6" data-line-number="6">  fits &lt;-<span class="st"> </span><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="cf">function</span>(x){</a>
<a class="sourceLine" id="cb192-7" data-line-number="7">    <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/models/matched_%s_%s_%s_%s.RData&quot;</span>, wd, trait, outcome, mod, x))</a>
<a class="sourceLine" id="cb192-8" data-line-number="8">    <span class="kw">class</span>(fit) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brmsfit_multiple&quot;</span>, <span class="kw">class</span>(fit))</a>
<a class="sourceLine" id="cb192-9" data-line-number="9">    <span class="kw">return</span>(fit)})</a>
<a class="sourceLine" id="cb192-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb192-11" data-line-number="11">  <span class="co"># combine models #</span></a>
<a class="sourceLine" id="cb192-12" data-line-number="12">  <span class="co"># get the rhat values</span></a>
<a class="sourceLine" id="cb192-13" data-line-number="13">  rhats &lt;-<span class="st"> </span><span class="kw">map_df</span>(fits, <span class="cf">function</span>(x)<span class="kw">data.frame</span>(<span class="kw">as.list</span>(<span class="kw">rhat</span>(x))))</a>
<a class="sourceLine" id="cb192-14" data-line-number="14">  <span class="co"># combined the models</span></a>
<a class="sourceLine" id="cb192-15" data-line-number="15">  fits &lt;-<span class="st"> </span><span class="kw">combine_models</span>(<span class="dt">mlist =</span> fits, <span class="dt">check_data =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb192-16" data-line-number="16">  <span class="co"># change the data name</span></a>
<a class="sourceLine" id="cb192-17" data-line-number="17">  fits<span class="op">$</span>data.name &lt;-<span class="st"> &quot;df_l&quot;</span></a>
<a class="sourceLine" id="cb192-18" data-line-number="18">  <span class="co"># add in pooled rhats</span></a>
<a class="sourceLine" id="cb192-19" data-line-number="19">  fits<span class="op">$</span>rhats &lt;-<span class="st"> </span>rhats</a>
<a class="sourceLine" id="cb192-20" data-line-number="20">  <span class="co"># change the class</span></a>
<a class="sourceLine" id="cb192-21" data-line-number="21">  <span class="kw">class</span>(fits) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;brmsfit_multiple&quot;</span>, <span class="kw">class</span>(fits))</a>
<a class="sourceLine" id="cb192-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb192-23" data-line-number="23">  <span class="co"># extract key parameters</span></a>
<a class="sourceLine" id="cb192-24" data-line-number="24">  <span class="co"># fixed effects</span></a>
<a class="sourceLine" id="cb192-25" data-line-number="25">  fx &lt;-<span class="st"> </span><span class="kw">fixef</span>(fits, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>)) <span class="op">%&gt;%</span><span class="st"> </span>data.frame <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-26" data-line-number="26"><span class="st">    </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;names&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-27" data-line-number="27"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>names), <span class="kw">lst</span>(<span class="dt">OR =</span> exp)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-28" data-line-number="28"><span class="st">    </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb192-29" data-line-number="29">  <span class="co"># random effects</span></a>
<a class="sourceLine" id="cb192-30" data-line-number="30">  rx &lt;-<span class="st"> </span><span class="kw">coef</span>(fits, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>))[[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">array_tree</span>(<span class="dv">3</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-31" data-line-number="31"><span class="st">    </span><span class="kw">tibble</span>(<span class="dt">names =</span> <span class="kw">names</span>(.), <span class="dt">data =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-32" data-line-number="32"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span>data.frame <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-33" data-line-number="33"><span class="st">                        </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;study&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-34" data-line-number="34"><span class="st">    </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-35" data-line-number="35"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="op">-</span>names, <span class="op">-</span>study), <span class="kw">lst</span>(<span class="dt">OR =</span> exp)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-36" data-line-number="36"><span class="st">    </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb192-37" data-line-number="37">  </a>
<a class="sourceLine" id="cb192-38" data-line-number="38">  <span class="co"># variance covariance matrix</span></a>
<a class="sourceLine" id="cb192-39" data-line-number="39">  vc &lt;-<span class="st"> </span><span class="kw">VarCorr</span>(fits, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="fl">0.055</span>, <span class="fl">0.945</span>))<span class="op">$</span>study</a>
<a class="sourceLine" id="cb192-40" data-line-number="40"></a>
<a class="sourceLine" id="cb192-41" data-line-number="41">  <span class="co"># samples</span></a>
<a class="sourceLine" id="cb192-42" data-line-number="42">  <span class="co"># fixed </span></a>
<a class="sourceLine" id="cb192-43" data-line-number="43">  fx.draws &lt;-<span class="st"> </span>fits <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy_draws</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-44" data-line-number="44"><span class="st">    </span><span class="kw">select</span>(.chain<span class="op">:</span>.draw, <span class="kw">matches</span>(<span class="st">&quot;^b_&quot;</span>), <span class="kw">matches</span>(<span class="st">&quot;p_value]$&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-45" data-line-number="45"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(<span class="kw">matches</span>(<span class="st">&quot;p_value]$&quot;</span>)), <span class="op">~</span>(.) <span class="op">+</span><span class="st"> </span>b_p_value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-46" data-line-number="46"><span class="st">    </span><span class="kw">gather</span>(<span class="dt">key =</span> item, <span class="dt">value =</span> s_value, <span class="op">-</span>(.chain<span class="op">:</span>.draw))</a>
<a class="sourceLine" id="cb192-47" data-line-number="47">  <span class="co"># random</span></a>
<a class="sourceLine" id="cb192-48" data-line-number="48">  tau.draws &lt;-<span class="st"> </span>fits <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tidy_draws</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb192-49" data-line-number="49"><span class="st">    </span><span class="kw">select</span>(.chain<span class="op">:</span>.draw, <span class="kw">matches</span>(<span class="st">&quot;^sd&quot;</span>), <span class="kw">matches</span>(<span class="st">&quot;^cor&quot;</span>))</a>
<a class="sourceLine" id="cb192-50" data-line-number="50"></a>
<a class="sourceLine" id="cb192-51" data-line-number="51">  <span class="co"># if it&#39;s a moderator model, get and save predicted values</span></a>
<a class="sourceLine" id="cb192-52" data-line-number="52">  <span class="cf">if</span>(mod <span class="op">!=</span><span class="st"> &quot;none&quot;</span>){</a>
<a class="sourceLine" id="cb192-53" data-line-number="53">    pred.fx &lt;-<span class="st"> </span><span class="kw">fx_pred_fun</span>(fits, m)</a>
<a class="sourceLine" id="cb192-54" data-line-number="54">    pred.rx &lt;-<span class="st"> </span><span class="kw">rx_pred_fun</span>(fits, m)</a>
<a class="sourceLine" id="cb192-55" data-line-number="55">    <span class="kw">save</span>(pred.fx, pred.rx, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/predicted/matched_pred_%s_%s_%s.RData&quot;</span>, wd, trait, outcome, mod))</a>
<a class="sourceLine" id="cb192-56" data-line-number="56">    <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">&quot;pred.fx&quot;</span>, <span class="st">&quot;pred.rx&quot;</span>))</a>
<a class="sourceLine" id="cb192-57" data-line-number="57">  }</a>
<a class="sourceLine" id="cb192-58" data-line-number="58"><span class="co"># save variance covariance matrix, fixed and random summaries, </span></a>
<a class="sourceLine" id="cb192-59" data-line-number="59"><span class="co"># and posterior draws to folders</span></a>
<a class="sourceLine" id="cb192-60" data-line-number="60">  <span class="kw">save</span>(vc, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/vc/matched_%s_%s_%s.RData&quot;</span>, wd, trait, outcome, mod))</a>
<a class="sourceLine" id="cb192-61" data-line-number="61">  <span class="kw">save</span>(fx, rx, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/summary/matched_%s_%s_%s.RData&quot;</span>, wd, trait, outcome, mod))</a>
<a class="sourceLine" id="cb192-62" data-line-number="62">  <span class="kw">save</span>(fx.draws, tau.draws, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/draws/matched_%s_%s_%s.RData&quot;</span>, wd, trait, outcome, mod))</a>
<a class="sourceLine" id="cb192-63" data-line-number="63">  <span class="co"># remove objects from local enviornment and clean up the garbage</span></a>
<a class="sourceLine" id="cb192-64" data-line-number="64">  <span class="kw">rm</span>(<span class="dt">list =</span> <span class="kw">c</span>(<span class="st">&quot;fits&quot;</span>, <span class="st">&quot;fx&quot;</span>, <span class="st">&quot;rx&quot;</span>, <span class="st">&quot;fx.draws&quot;</span>, <span class="st">&quot;tau.draws&quot;</span>))</a>
<a class="sourceLine" id="cb192-65" data-line-number="65">  <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb192-66" data-line-number="66">}</a></code></pre></div>
</div>
<div id="run-compilation" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Run Compilation</h3>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1"><span class="co"># get a list of models</span></a>
<a class="sourceLine" id="cb193-2" data-line-number="2">files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/models&quot;</span>, wd))</a>
<a class="sourceLine" id="cb193-3" data-line-number="3"></a>
<a class="sourceLine" id="cb193-4" data-line-number="4">done &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> <span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/summary&quot;</span>, wd))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-5" data-line-number="5"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Moderator =</span> <span class="kw">str_remove</span>(Moderator, <span class="st">&quot;.RData&quot;</span>), </a>
<a class="sourceLine" id="cb193-7" data-line-number="7">         <span class="dt">Done =</span> <span class="st">&quot;done&quot;</span>)</a>
<a class="sourceLine" id="cb193-8" data-line-number="8"></a>
<a class="sourceLine" id="cb193-9" data-line-number="9"><span class="kw">plan</span>(<span class="kw">multiprocess</span>(<span class="dt">workers =</span> 5L))</a>
<a class="sourceLine" id="cb193-10" data-line-number="10">res &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> files) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-11" data-line-number="11"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>, <span class="st">&quot;chain&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-12" data-line-number="12"><span class="st">  </span><span class="kw">group_by</span>(Trait, Outcome, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-13" data-line-number="13"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-14" data-line-number="14"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-15" data-line-number="15"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>scrap, <span class="op">-</span>chain) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-16" data-line-number="16"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-17" data-line-number="17"><span class="st">  </span><span class="kw">full_join</span>(done) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-18" data-line-number="18"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">is.na</span>(Done)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb193-19" data-line-number="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">c =</span> <span class="kw">future_pmap</span>(<span class="kw">list</span>(Trait, Outcome, Moderator)</a>
<a class="sourceLine" id="cb193-20" data-line-number="20">                         , <span class="kw">safely</span>(combine_fun)</a>
<a class="sourceLine" id="cb193-21" data-line-number="21">                         , <span class="dt">.progress =</span> T))</a>
<a class="sourceLine" id="cb193-22" data-line-number="22"><span class="kw">closeAllConnections</span>()</a></code></pre></div>
</div>
</div>
<div id="part-8-tables-and-plots" class="section level2">
<h2><span class="header-section-number">4.4</span> Part 8: Tables and Plots</h2>
<div id="summaries" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Summaries</h3>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="co"># short function for reading in model results</span></a>
<a class="sourceLine" id="cb194-2" data-line-number="2">load_fun &lt;-<span class="st"> </span><span class="cf">function</span>(file, ob){</a>
<a class="sourceLine" id="cb194-3" data-line-number="3">  <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/summary/%s&quot;</span>, wd, file))</a>
<a class="sourceLine" id="cb194-4" data-line-number="4">  <span class="kw">get</span>(<span class="kw">ls</span>()[<span class="kw">ls</span>() <span class="op">==</span><span class="st"> </span>ob])</a>
<a class="sourceLine" id="cb194-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb194-6" data-line-number="6"></a>
<a class="sourceLine" id="cb194-7" data-line-number="7"><span class="co"># load in fixed and random summaries</span></a>
<a class="sourceLine" id="cb194-8" data-line-number="8">fx_res &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> <span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/summary&quot;</span>, wd))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-9" data-line-number="9"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">remove =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Moderator =</span> <span class="kw">str_remove</span>(Moderator, <span class="st">&quot;.RData&quot;</span>),</a>
<a class="sourceLine" id="cb194-11" data-line-number="11">         <span class="dt">fx =</span> <span class="kw">map</span>(file, <span class="op">~</span><span class="kw">load_fun</span>(., <span class="st">&quot;fx&quot;</span>)),</a>
<a class="sourceLine" id="cb194-12" data-line-number="12">         <span class="dt">rx =</span> <span class="kw">map</span>(file, <span class="op">~</span><span class="kw">load_fun</span>(., <span class="st">&quot;rx&quot;</span>)))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb194-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>scrap, <span class="op">-</span>file)</a>
<a class="sourceLine" id="cb194-14" data-line-number="14"></a>
<a class="sourceLine" id="cb194-15" data-line-number="15"><span class="co"># random effects summaries</span></a>
<a class="sourceLine" id="cb194-16" data-line-number="16">rx_res &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>fx) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(rx) </a>
<a class="sourceLine" id="cb194-17" data-line-number="17"><span class="co"># fixed effect summaries</span></a>
<a class="sourceLine" id="cb194-18" data-line-number="18">fx_res &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>rx) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(fx) </a>
<a class="sourceLine" id="cb194-19" data-line-number="19"></a>
<a class="sourceLine" id="cb194-20" data-line-number="20"><span class="co"># %s significant </span></a>
<a class="sourceLine" id="cb194-21" data-line-number="21"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the tested unmoderated, matched personality-outcome associations were significant.&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 32.65% of the tested unmoderated, matched personality-outcome associations were significant.</code></pre>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:age&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;age&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by age.&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 10.2% of the matched personality-outcome associations were significantly moderated by age.</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:gender1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;gender&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by gender&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 9.18% of the matched personality-outcome associations were significantly moderated by gender</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:race1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;race&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by race (black v white)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 3.06% of the matched personality-outcome associations were significantly moderated by race (black v white)</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:race2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;race&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by race (other v white)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 0.51% of the matched personality-outcome associations were significantly moderated by race (other v white)</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:parEdu1&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;parEdu&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by parental education (SES; college v HS or lower)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 8.16% of the matched personality-outcome associations were significantly moderated by parental education (SES; college v HS or lower)</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:parEdu2&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;parEdu&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by parental education (SES; beyond college v HS or lower)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 4.08% of the matched personality-outcome associations were significantly moderated by parental education (SES; beyond college v HS or lower)</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:parOccPrstg&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;parOccPrstg&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by parental occupational prestige (SES)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 5.61% of the matched personality-outcome associations were significantly moderated by parental occupational prestige (SES)</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:grsWages&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;grsWages&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by gross wages (SES)&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 5.1% of the matched personality-outcome associations were significantly moderated by gross wages (SES)</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:reliability&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;reliability&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by personality scale reliability&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 1.02% of the matched personality-outcome associations were significantly moderated by personality scale reliability</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(fx_res <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(names <span class="op">==</span><span class="st"> &quot;p_value:predInt&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Moderator <span class="op">==</span><span class="st"> &quot;predInt&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)))<span class="op">/</span><span class="dv">196</span><span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of the matched personality-outcome associations were significantly moderated by the interval between personality and outcome measures&quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 7.65% of the matched personality-outcome associations were significantly moderated by the interval between personality and outcome measures</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" data-line-number="1"><span class="co">## traits </span></a>
<a class="sourceLine" id="cb216-2" data-line-number="2">sig_mod &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb216-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb216-4" data-line-number="4"><span class="st">         </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb216-5" data-line-number="5"><span class="st">         </span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb216-6" data-line-number="6"><span class="st">  </span><span class="kw">select</span>(Trait, Outcome, Moderator) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb216-7" data-line-number="7"><span class="st">  </span><span class="kw">distinct</span>() </a>
<a class="sourceLine" id="cb216-8" data-line-number="8"></a>
<a class="sourceLine" id="cb216-9" data-line-number="9"><span class="kw">cat</span>(<span class="kw">round</span>(<span class="kw">nrow</span>(sig_mod)<span class="op">/</span>(<span class="dv">14</span><span class="op">*</span><span class="dv">14</span><span class="op">*</span><span class="dv">8</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>), <span class="st">&quot;% of personality-outcome associations had reliable moderators effects.&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## 6.7% of personality-outcome associations had reliable moderators effects.</code></pre>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">mapvalues</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)))<span class="op">$</span>Trait[<span class="dv">1</span>], traits<span class="op">$</span>short_name, traits<span class="op">$</span>long_name, <span class="dt">warn_missing =</span>F), <span class="st">&quot; was the most frequently moderated personality characteristic (&quot;</span>, <span class="kw">round</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)))<span class="op">$</span>n[<span class="dv">1</span>]<span class="op">/</span>(<span class="dv">14</span><span class="op">*</span><span class="dv">8</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>) ,<span class="st">&quot;%), while &quot;</span>,  <span class="kw">mapvalues</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(n))<span class="op">$</span>Trait[<span class="dv">1</span>], traits<span class="op">$</span>short_name, traits<span class="op">$</span>long_name, <span class="dt">warn_missing =</span>F), <span class="st">&quot; was the least frequently moderated trait (&quot;</span>, <span class="kw">round</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(n))<span class="op">$</span>n[<span class="dv">1</span>]<span class="op">/</span>(<span class="dv">14</span><span class="op">*</span><span class="dv">8</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>) ,<span class="st">&quot;%).&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Social Support was the most frequently moderated personality characteristic (12.5%), while Optimism was the least frequently moderated trait (2.68%).</code></pre>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1"><span class="kw">cat</span>(<span class="kw">mapvalues</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)))<span class="op">$</span>Outcome[<span class="dv">1</span>], outcomes<span class="op">$</span>short_name, outcomes<span class="op">$</span>long_name, <span class="dt">warn_missing =</span>F), <span class="st">&quot; was the most frequently moderated outcome (&quot;</span>, <span class="kw">round</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)))<span class="op">$</span>n[<span class="dv">1</span>]<span class="op">/</span>(<span class="dv">14</span><span class="op">*</span><span class="dv">8</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>) ,<span class="st">&quot;%), while &quot;</span>,  <span class="kw">mapvalues</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(n))<span class="op">$</span>Outcome[<span class="dv">1</span>], outcomes<span class="op">$</span>short_name, outcomes<span class="op">$</span>long_name, <span class="dt">warn_missing =</span>F), <span class="st">&quot; was the least frequently moderated outcome (&quot;</span>, <span class="kw">round</span>((sig_mod <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(n))<span class="op">$</span>n[<span class="dv">1</span>]<span class="op">/</span>(<span class="dv">14</span><span class="op">*</span><span class="dv">8</span>)<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>) ,<span class="st">&quot;%).&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## Unemployment was the most frequently moderated outcome (13.39%), while Higher Ed was the least frequently moderated outcome (3.57%).</code></pre>
<div id="plots" class="section level4">
<h4><span class="header-section-number">4.4.1.1</span> Plots</h4>
<div id="study-specific-forest-plots" class="section level5">
<h5><span class="header-section-number">4.4.1.1.1</span> Study-Specific Forest Plots</h5>
<p>The function below creates a plot for each outcome-moderator combination of mega-analytic and study-specific associations across traits and saves them to a folder.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, outcome, mod){</a>
<a class="sourceLine" id="cb222-2" data-line-number="2">  <span class="kw">print</span>(<span class="kw">paste</span>(outcome, mod))</a>
<a class="sourceLine" id="cb222-3" data-line-number="3">  o &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(outcome, outcomes<span class="op">$</span>short_name, outcomes<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb222-4" data-line-number="4">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>mod, moderators<span class="op">$</span>mod_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb222-5" data-line-number="5">  d &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">min</span>(df<span class="op">$</span>Estimate_OR)), <span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">max</span>(df<span class="op">$</span>Estimate_OR))), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb222-6" data-line-number="6">  lim &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">c</span>(.<span class="dv">68</span>, <span class="fl">1.32</span>)} <span class="cf">else</span>{<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="fl">2.5</span>), <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="fl">2.5</span>))}</a>
<a class="sourceLine" id="cb222-7" data-line-number="7">  brk &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">seq</span>(.<span class="dv">75</span>, <span class="fl">1.25</span>, <span class="fl">.25</span>)} <span class="cf">else</span>{<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)),<span class="dv">2</span>)}</a>
<a class="sourceLine" id="cb222-8" data-line-number="8">  lab &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">c</span>(<span class="st">&quot;.75&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1.25&quot;</span>)} <span class="cf">else</span>{<span class="kw">str_remove</span>(<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)),<span class="dv">2</span>), <span class="st">&quot;^0&quot;</span>)}</a>
<a class="sourceLine" id="cb222-9" data-line-number="9">  shapes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>)[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names))]</a>
<a class="sourceLine" id="cb222-10" data-line-number="10">  lt &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;solid&quot;</span>, <span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names)))</a>
<a class="sourceLine" id="cb222-11" data-line-number="11">  titl &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){o} <span class="cf">else</span> {<span class="kw">sprintf</span>(<span class="st">&quot;%s: Personality x %s&quot;</span>, o, m)}</a>
<a class="sourceLine" id="cb222-12" data-line-number="12">  leg &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){<span class="st">&quot;bottom&quot;</span>} <span class="cf">else</span> {<span class="st">&quot;none&quot;</span>}</a>
<a class="sourceLine" id="cb222-13" data-line-number="13">  p &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-14" data-line-number="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Q5.5_OR =</span> <span class="kw">ifelse</span>(Q5<span class="fl">.5</span>_OR <span class="op">&lt;</span><span class="st"> </span>lim[<span class="dv">1</span>], lim[<span class="dv">1</span>], Q5<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb222-15" data-line-number="15">           <span class="dt">Q94.5_OR =</span> <span class="kw">ifelse</span>(Q94<span class="fl">.5</span>_OR <span class="op">&gt;</span><span class="st"> </span>lim[<span class="dv">2</span>], lim[<span class="dv">2</span>], Q94<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb222-16" data-line-number="16">           <span class="dt">study =</span> <span class="kw">factor</span>(study, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Overall&quot;</span>, studies_long)),</a>
<a class="sourceLine" id="cb222-17" data-line-number="17">           <span class="dt">Trait =</span> <span class="kw">factor</span>(Trait, <span class="dt">levels =</span> traits<span class="op">$</span>short_name, <span class="dt">labels =</span> traits<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-18" data-line-number="18"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> study, <span class="dt">y =</span> Estimate_OR)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-19" data-line-number="19"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> lim, <span class="dt">breaks =</span> brk, <span class="dt">labels =</span> lab) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-20" data-line-number="20"><span class="st">      </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">2.5</span>, <span class="fl">1.5</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-21" data-line-number="21"><span class="st">      </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> shapes) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-22" data-line-number="22"><span class="st">      </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-23" data-line-number="23"><span class="st">      </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> lt) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-24" data-line-number="24"><span class="st">      </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>), <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-25" data-line-number="25"><span class="st">      </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q5<span class="fl">.5</span>_OR, <span class="dt">ymax =</span> Q94<span class="fl">.5</span>_OR, <span class="dt">linetype =</span> names)</a>
<a class="sourceLine" id="cb222-26" data-line-number="26">                    , <span class="dt">width =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb222-27" data-line-number="27">                    , <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">.9</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-28" data-line-number="28"><span class="st">      </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> type, <span class="dt">size =</span> type, <span class="dt">shape =</span> names)</a>
<a class="sourceLine" id="cb222-29" data-line-number="29">                    , <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">.9</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-30" data-line-number="30"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;Odds Ratio&quot;</span>, <span class="dt">title =</span> titl) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-31" data-line-number="31"><span class="st">      </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Trait, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">nrow =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-32" data-line-number="32"><span class="st">      </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb222-33" data-line-number="33"><span class="st">      </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb222-34" data-line-number="34"><span class="st">      </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> leg,</a>
<a class="sourceLine" id="cb222-35" data-line-number="35">            <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="fl">1.2</span>), <span class="dt">hjust =</span> <span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb222-36" data-line-number="36">            <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb222-37" data-line-number="37">            <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>),</a>
<a class="sourceLine" id="cb222-38" data-line-number="38">            <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>))</a>
<a class="sourceLine" id="cb222-39" data-line-number="39">  <span class="kw">ggsave</span>(p, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/study specific forest/%s/matched_%s.pdf&quot;</span>, wd, mod, outcome), <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb222-40" data-line-number="40">  <span class="kw">save</span>(p, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/study specific forest/rdata/matched_%s_%s.RData&quot;</span>, wd, outcome, mod))</a>
<a class="sourceLine" id="cb222-41" data-line-number="41">  <span class="kw">rm</span>(p)</a>
<a class="sourceLine" id="cb222-42" data-line-number="42">  <span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb222-43" data-line-number="43">  <span class="kw">return</span>(T)</a>
<a class="sourceLine" id="cb222-44" data-line-number="44">}</a>
<a class="sourceLine" id="cb222-45" data-line-number="45"></a>
<a class="sourceLine" id="cb222-46" data-line-number="46"><span class="co"># keep only personality-outcome associations in the unmoderated</span></a>
<a class="sourceLine" id="cb222-47" data-line-number="47"><span class="co"># models or the moderator association in the moderated models</span></a>
<a class="sourceLine" id="cb222-48" data-line-number="48">cmb_res &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-49" data-line-number="49"><span class="st">  </span><span class="kw">filter</span>((Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span>)<span class="op">|</span></a>
<a class="sourceLine" id="cb222-50" data-line-number="50"><span class="st">         </span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb222-51" data-line-number="51"><span class="st">         </span>(<span class="op">!</span>Moderator <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-52" data-line-number="52"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">study =</span> <span class="st">&quot;Overall&quot;</span>, <span class="dt">type =</span> <span class="st">&quot;fixed&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-53" data-line-number="53"><span class="st">  </span><span class="kw">full_join</span>(</a>
<a class="sourceLine" id="cb222-54" data-line-number="54">    rx_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-55" data-line-number="55"><span class="st">      </span><span class="kw">filter</span>((Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span>)<span class="op">|</span></a>
<a class="sourceLine" id="cb222-56" data-line-number="56"><span class="st">             </span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names)) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb222-57" data-line-number="57"><span class="st">         </span>(<span class="op">!</span>Moderator <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb222-58" data-line-number="58"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">type =</span> <span class="st">&quot;random&quot;</span>)</a>
<a class="sourceLine" id="cb222-59" data-line-number="59">  ) </a>
<a class="sourceLine" id="cb222-60" data-line-number="60"></a>
<a class="sourceLine" id="cb222-61" data-line-number="61"><span class="co"># run the plot function</span></a>
<a class="sourceLine" id="cb222-62" data-line-number="62">cmb_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-63" data-line-number="63"><span class="st">  </span><span class="kw">group_by</span>(Outcome, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-64" data-line-number="64"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-65" data-line-number="65"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb222-66" data-line-number="66"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">pmap</span>(<span class="kw">list</span>(data, Outcome, Moderator), plot_fun))</a></code></pre></div>
</div>
<div id="fixed-effect-forest-plots" class="section level5">
<h5><span class="header-section-number">4.4.1.1.2</span> Fixed-Effect Forest Plots</h5>
<p>Now that we have plots of both mega-analytic and study-specific effects, well plot just the mega-analytic effecs for each moderator for parsimony (i.e.each of the 196 personality-outcome associations or moderators of them in a single graph).</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb223-1" data-line-number="1">fx_plot_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, mod){</a>
<a class="sourceLine" id="cb223-2" data-line-number="2">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>short_name, moderators<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb223-3" data-line-number="3">  d &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">min</span>(df<span class="op">$</span>Estimate_OR)), <span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">max</span>(df<span class="op">$</span>Estimate_OR))), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb223-4" data-line-number="4">  lim &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">c</span>(.<span class="dv">8</span>, <span class="fl">1.2</span>)} <span class="cf">else</span>{<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="fl">2.5</span>), <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="fl">2.5</span>))}</a>
<a class="sourceLine" id="cb223-5" data-line-number="5">  brk &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">seq</span>(.<span class="dv">85</span>, <span class="fl">1.15</span>, <span class="fl">.15</span>)} <span class="cf">else</span>{<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)),<span class="dv">2</span>)}</a>
<a class="sourceLine" id="cb223-6" data-line-number="6">  lab &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="kw">c</span>(<span class="st">&quot;.85&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1.15&quot;</span>)} <span class="cf">else</span>{<span class="kw">str_remove</span>(<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">5</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)),<span class="dv">2</span>), <span class="st">&quot;^0&quot;</span>)}</a>
<a class="sourceLine" id="cb223-7" data-line-number="7">  shapes &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>)[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names))]</a>
<a class="sourceLine" id="cb223-8" data-line-number="8">  lt &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="st">&quot;solid&quot;</span>, <span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names)))</a>
<a class="sourceLine" id="cb223-9" data-line-number="9">  titl &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){<span class="ot">NULL</span>} <span class="cf">else</span> {<span class="kw">sprintf</span>(<span class="st">&quot;%s Moderation of Personality-Outcome Associations&quot;</span>, m)}</a>
<a class="sourceLine" id="cb223-10" data-line-number="10">  leg &lt;-<span class="st"> </span><span class="cf">if</span>(<span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>names)) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>){<span class="st">&quot;bottom&quot;</span>} <span class="cf">else</span> {<span class="st">&quot;none&quot;</span>}</a>
<a class="sourceLine" id="cb223-11" data-line-number="11">  p &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-12" data-line-number="12"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Q5.5_OR =</span> <span class="kw">ifelse</span>(Q5<span class="fl">.5</span>_OR <span class="op">&lt;</span><span class="st"> </span>lim[<span class="dv">1</span>], lim[<span class="dv">1</span>], Q5<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb223-13" data-line-number="13">           <span class="dt">Q94.5_OR =</span> <span class="kw">ifelse</span>(Q94<span class="fl">.5</span>_OR <span class="op">&gt;</span><span class="st"> </span>lim[<span class="dv">2</span>], lim[<span class="dv">2</span>], Q94<span class="fl">.5</span>_OR)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-14" data-line-number="14"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Outcome, <span class="dt">y =</span> Estimate_OR)) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-15" data-line-number="15"><span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> lim, <span class="dt">breaks =</span> brk, <span class="dt">labels =</span> lab) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-16" data-line-number="16"><span class="st">    </span><span class="kw">scale_size_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="fl">1.2</span>, <span class="fl">.85</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-17" data-line-number="17"><span class="st">    </span><span class="kw">scale_shape_manual</span>(<span class="dt">values =</span> shapes) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-18" data-line-number="18"><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;black&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-19" data-line-number="19"><span class="st">    </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> lt) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-20" data-line-number="20"><span class="st">    </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>), <span class="dt">size =</span> <span class="fl">.25</span>, <span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-21" data-line-number="21"><span class="st">    </span><span class="kw">geom_errorbar</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q5<span class="fl">.5</span>_OR, <span class="dt">ymax =</span> Q94<span class="fl">.5</span>_OR, <span class="dt">linetype =</span> names)</a>
<a class="sourceLine" id="cb223-22" data-line-number="22">                  , <span class="dt">width =</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb223-23" data-line-number="23">                  , <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">.9</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-24" data-line-number="24"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> sig, <span class="dt">size =</span> sig, <span class="dt">shape =</span> names)</a>
<a class="sourceLine" id="cb223-25" data-line-number="25">                  , <span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">.9</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-26" data-line-number="26"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="ot">NULL</span>, <span class="dt">y =</span> <span class="st">&quot;Odds Ratio&quot;</span>, <span class="dt">title =</span> titl) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-27" data-line-number="27"><span class="st">    </span><span class="kw">facet_grid</span>(<span class="op">~</span>Trait, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>, <span class="dt">space =</span> <span class="st">&quot;free&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb223-28" data-line-number="28"><span class="st">    </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb223-29" data-line-number="29"><span class="st">    </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb223-30" data-line-number="30"><span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> leg,</a>
<a class="sourceLine" id="cb223-31" data-line-number="31">          <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="fl">1.2</span>), <span class="dt">hjust =</span> <span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb223-32" data-line-number="32">          <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>),</a>
<a class="sourceLine" id="cb223-33" data-line-number="33">          <span class="dt">strip.background =</span> <span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb223-34" data-line-number="34">          <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="fl">1.4</span>)),</a>
<a class="sourceLine" id="cb223-35" data-line-number="35">          <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>),</a>
<a class="sourceLine" id="cb223-36" data-line-number="36">          <span class="dt">axis.text.y =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="kw">rel</span>(<span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb223-37" data-line-number="37"><span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/overall forest/%s_fixed.png&quot;</span>, wd, mod), <span class="dt">width =</span> <span class="dv">10</span>, <span class="dt">height =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb223-38" data-line-number="38"><span class="kw">save</span>(p, <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/overall forest/rdata/%s_fixed.RData&quot;</span>, wd, mod))</a>
<a class="sourceLine" id="cb223-39" data-line-number="39"><span class="kw">rm</span>(p)</a>
<a class="sourceLine" id="cb223-40" data-line-number="40"><span class="kw">gc</span>()</a>
<a class="sourceLine" id="cb223-41" data-line-number="41"><span class="kw">return</span>(T)</a>
<a class="sourceLine" id="cb223-42" data-line-number="42">}</a>
<a class="sourceLine" id="cb223-43" data-line-number="43"></a>
<a class="sourceLine" id="cb223-44" data-line-number="44">fx_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb223-45" data-line-number="45"><span class="st">    </span><span class="kw">filter</span>((Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span>)<span class="op">|</span></a>
<a class="sourceLine" id="cb223-46" data-line-number="46"><span class="st">         </span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-47" data-line-number="47"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>), <span class="st">&quot;sig&quot;</span>, <span class="st">&quot;ns&quot;</span>),</a>
<a class="sourceLine" id="cb223-48" data-line-number="48">           <span class="dt">sig =</span> <span class="kw">factor</span>(sig, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;sig&quot;</span>,<span class="st">&quot;ns&quot;</span>)),</a>
<a class="sourceLine" id="cb223-49" data-line-number="49">           <span class="dt">Trait =</span> <span class="kw">factor</span>(Trait, <span class="dt">levels =</span> traits<span class="op">$</span>short_name),</a>
<a class="sourceLine" id="cb223-50" data-line-number="50">           <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span> <span class="kw">str_wrap</span>(outcomes<span class="op">$</span>long_name, <span class="dv">15</span>)),</a>
<a class="sourceLine" id="cb223-51" data-line-number="51">           <span class="dt">Outcome =</span> forcats<span class="op">::</span><span class="kw">fct_rev</span>(Outcome))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-52" data-line-number="52"><span class="st">  </span><span class="kw">group_by</span>(Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-53" data-line-number="53"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-54" data-line-number="54"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb223-55" data-line-number="55"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">map2</span>(data, Moderator, fx_plot_fun))</a></code></pre></div>
</div>
</div>
<div id="tables" class="section level4">
<h4><span class="header-section-number">4.4.1.2</span> Tables</h4>
<div id="study-specific" class="section level5">
<h5><span class="header-section-number">4.4.1.2.1</span> Study-Specific</h5>
<p>First, Ill create tables of personality-outcome associations for each moderator (including unmoderated results) and create a table with both the mega-analytic and study-specific associations across traits and outcomes.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">psm_tab_fun &lt;-<span class="st"> </span><span class="cf">function</span>(d, mod){</a>
<a class="sourceLine" id="cb224-2" data-line-number="2">  t_cols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">14</span>); <span class="kw">names</span>(t_cols) &lt;-<span class="st"> </span>traits<span class="op">$</span>long_name</a>
<a class="sourceLine" id="cb224-3" data-line-number="3">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>short_name, moderators<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb224-4" data-line-number="4">  <span class="co"># restructure data for tabling</span></a>
<a class="sourceLine" id="cb224-5" data-line-number="5">  tab &lt;-<span class="st"> </span>d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-6" data-line-number="6"><span class="st">    </span><span class="co"># format values rounded to 2 decimal places and bolded if significant</span></a>
<a class="sourceLine" id="cb224-7" data-line-number="7"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate_OR<span class="op">:</span>Q94<span class="fl">.5</span>_OR), <span class="op">~</span><span class="kw">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-8" data-line-number="8"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s, %s]&quot;</span>, Estimate_OR, Q5<span class="fl">.5</span>_OR, Q94<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb224-9" data-line-number="9">           <span class="dt">est =</span> <span class="kw">ifelse</span>(sig <span class="op">==</span><span class="st"> &quot;sig&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;&lt;strong&gt;%s&lt;/strong&gt;&quot;</span>, est), est)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-10" data-line-number="10"><span class="st">    </span><span class="kw">select</span>(Trait, Outcome, study, names, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-11" data-line-number="11"><span class="st">    </span><span class="co"># spread it wide and order Outcomes, columns, and studies</span></a>
<a class="sourceLine" id="cb224-12" data-line-number="12"><span class="st">    </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span> , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>, <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-13" data-line-number="13"><span class="st">    </span><span class="kw">left_join</span>(<span class="kw">crossing</span>(<span class="dt">Outcome =</span> outcomes<span class="op">$</span>short_name, <span class="dt">Trait =</span> traits<span class="op">$</span>short_name, <span class="dt">study =</span> <span class="st">&quot;Overall&quot;</span>, <span class="dt">value  =</span> <span class="ot">NA_character_</span>, <span class="dt">names =</span> <span class="kw">unique</span>(d<span class="op">$</span>names)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(Trait, value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-14" data-line-number="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, outcomes<span class="op">$</span>long_name),</a>
<a class="sourceLine" id="cb224-15" data-line-number="15">           <span class="dt">study =</span> <span class="kw">factor</span>(study, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;Overall&quot;</span>, studies_long))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-16" data-line-number="16"><span class="st">    </span><span class="kw">arrange</span>(Outcome, study) </a>
<a class="sourceLine" id="cb224-17" data-line-number="17">  <span class="co"># a little bit of housekeeping so moderators play nicely together</span></a>
<a class="sourceLine" id="cb224-18" data-line-number="18">  mod_old &lt;-<span class="st"> </span><span class="kw">unique</span>(d<span class="op">$</span>names)</a>
<a class="sourceLine" id="cb224-19" data-line-number="19">  mod_num &lt;-<span class="st"> </span><span class="kw">length</span>(mod_old)</a>
<a class="sourceLine" id="cb224-20" data-line-number="20">  <span class="cf">if</span>(mod_num <span class="op">==</span><span class="st"> </span><span class="dv">1</span>){</a>
<a class="sourceLine" id="cb224-21" data-line-number="21">    keep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;study&quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb224-22" data-line-number="22">    cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Study&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;OR [CI]&quot;</span>, <span class="dt">times =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb224-23" data-line-number="23">    t_cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span><span class="dv">1</span>, t_cols)</a>
<a class="sourceLine" id="cb224-24" data-line-number="24">    algn &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb224-25" data-line-number="25">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb224-26" data-line-number="26">    keep &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;study&quot;</span>, <span class="st">&quot;names&quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb224-27" data-line-number="27">    cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Study&quot;</span>, <span class="st">&quot;Moderator&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;OR [CI]&quot;</span>, <span class="dt">times =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb224-28" data-line-number="28">    mod_new &lt;-<span class="st"> </span><span class="kw">str_replace</span>(<span class="kw">str_remove</span>(mod_old, <span class="st">&quot;p_value:&quot;</span>), mod, <span class="kw">paste</span>(m, <span class="st">&quot; &quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb224-29" data-line-number="29">    tab &lt;-<span class="st"> </span>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">names =</span> <span class="kw">mapvalues</span>(names, mod_old, mod_new))</a>
<a class="sourceLine" id="cb224-30" data-line-number="30">    t_cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span> =<span class="st"> </span><span class="dv">2</span>, t_cols)</a>
<a class="sourceLine" id="cb224-31" data-line-number="31">    algn &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb224-32" data-line-number="32">  }</a>
<a class="sourceLine" id="cb224-33" data-line-number="33">  cap &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>) <span class="st">&quot;Mega-Analytic and Study-Specific Personality-Outcome Associations in Matched Samples&quot;</span> <span class="cf">else</span> <span class="kw">sprintf</span>(<span class="st">&quot;Mega-Analytic and Study-Specific %s Moderation of Personality-Outcome Associations in Matched Samples&quot;</span>, m)</a>
<a class="sourceLine" id="cb224-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb224-35" data-line-number="35"> rs &lt;-<span class="st"> </span>tab <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">group_by</span>(Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-36" data-line-number="36"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">end =</span> <span class="kw">cumsum</span>(n), <span class="dt">start =</span> <span class="kw">lag</span>(end) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">start =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(start), <span class="dv">1</span>, start))</a>
<a class="sourceLine" id="cb224-37" data-line-number="37">  </a>
<a class="sourceLine" id="cb224-38" data-line-number="38">  tab <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-39" data-line-number="39"><span class="st">    </span><span class="kw">select</span>(<span class="kw">one_of</span>(keep)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-40" data-line-number="40"><span class="st">    </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb224-41" data-line-number="41">          , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb224-42" data-line-number="42">          , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb224-43" data-line-number="43">          , <span class="dt">col.names =</span> cols</a>
<a class="sourceLine" id="cb224-44" data-line-number="44">          , <span class="dt">align =</span> algn</a>
<a class="sourceLine" id="cb224-45" data-line-number="45">          , <span class="dt">caption =</span> cap) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-46" data-line-number="46"><span class="st">    </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-47" data-line-number="47"><span class="st">    </span><span class="kw">add_header_above</span>(t_cols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-48" data-line-number="48"><span class="st">    </span><span class="kw">collapse_rows</span>(<span class="dv">1</span>, <span class="dt">valign =</span> <span class="st">&quot;top&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-49" data-line-number="49"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Mortality&quot;</span>, rs<span class="op">$</span>start[<span class="dv">1</span>], rs<span class="op">$</span>end[<span class="dv">1</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-50" data-line-number="50"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Major Health Event&quot;</span>, rs<span class="op">$</span>start[<span class="dv">2</span>], rs<span class="op">$</span>end[<span class="dv">2</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-51" data-line-number="51"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Mental Health Event&quot;</span>, rs<span class="op">$</span>start[<span class="dv">3</span>], rs<span class="op">$</span>end[<span class="dv">3</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-52" data-line-number="52"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Child Birth&quot;</span>,rs<span class="op">$</span>start[<span class="dv">4</span>], rs<span class="op">$</span>end[<span class="dv">4</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-53" data-line-number="53"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Move in with a partner&quot;</span>, rs<span class="op">$</span>start[<span class="dv">5</span>], rs<span class="op">$</span>end[<span class="dv">5</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-54" data-line-number="54"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Marriage&quot;</span>, rs<span class="op">$</span>start[<span class="dv">6</span>], rs<span class="op">$</span>end[<span class="dv">6</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-55" data-line-number="55"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Divorce&quot;</span>, rs<span class="op">$</span>start[<span class="dv">7</span>], rs<span class="op">$</span>end[<span class="dv">7</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-56" data-line-number="56"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Child Moves Out&quot;</span>, rs<span class="op">$</span>start[<span class="dv">8</span>], rs<span class="op">$</span>end[<span class="dv">8</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-57" data-line-number="57"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Higher Education&quot;</span>, rs<span class="op">$</span>start[<span class="dv">9</span>], rs<span class="op">$</span>end[<span class="dv">9</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-58" data-line-number="58"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;First Job&quot;</span>, rs<span class="op">$</span>start[<span class="dv">10</span>], rs<span class="op">$</span>end[<span class="dv">10</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-59" data-line-number="59"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Unemployment&quot;</span>, rs<span class="op">$</span>start[<span class="dv">11</span>], rs<span class="op">$</span>end[<span class="dv">11</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-60" data-line-number="60"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Retirement&quot;</span>, rs<span class="op">$</span>start[<span class="dv">12</span>], rs<span class="op">$</span>end[<span class="dv">12</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-61" data-line-number="61"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Volunteering&quot;</span>, rs<span class="op">$</span>start[<span class="dv">13</span>], rs<span class="op">$</span>end[<span class="dv">13</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-62" data-line-number="62"><span class="st">    </span>kableExtra<span class="op">::</span><span class="kw">group_rows</span>(<span class="st">&quot;Criminality&quot;</span>, rs<span class="op">$</span>start[<span class="dv">14</span>], rs<span class="op">$</span>end[<span class="dv">14</span>], <span class="dt">label_row_css =</span> <span class="ot">NULL</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-63" data-line-number="63"><span class="st">    </span><span class="kw">footnote</span>(<span class="st">&quot;&lt;em&gt;OR&lt;/em&gt; = Odds Ratio; &lt;em&gt;UI&lt;/em&gt; = 89% Bayesian Uncertainty Interval. Bold indicates model terms whose 89% UI of log odds did not overlap with 0.&quot;</span>, <span class="dt">escape =</span> F)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-64" data-line-number="64"><span class="st">    </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/study specific/%s.html&quot;</span>, wd, mod))</a>
<a class="sourceLine" id="cb224-65" data-line-number="65">}</a>
<a class="sourceLine" id="cb224-66" data-line-number="66"></a>
<a class="sourceLine" id="cb224-67" data-line-number="67">cmb_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-68" data-line-number="68"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>), <span class="st">&quot;sig&quot;</span>, <span class="st">&quot;ns&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-69" data-line-number="69"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>(Estimate<span class="op">:</span>Q94<span class="fl">.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-70" data-line-number="70"><span class="st">  </span><span class="kw">group_by</span>(Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-71" data-line-number="71"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-72" data-line-number="72"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-73" data-line-number="73"><span class="st">  </span><span class="co"># filter(Moderator == &quot;none&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb224-74" data-line-number="74"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">map2</span>(data, Moderator, <span class="kw">possibly</span>(psm_tab_fun, <span class="ot">NA_real_</span>)))</a></code></pre></div>
</div>
<div id="fixed-effects" class="section level5">
<h5><span class="header-section-number">4.4.1.2.2</span> Fixed Effects</h5>
<p>Next, Ill create more parsimonious tables for each moderator.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1">psm_fxd_tab_fun &lt;-<span class="st"> </span><span class="cf">function</span>(d, mod){</a>
<a class="sourceLine" id="cb225-2" data-line-number="2">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>short_name, moderators<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb225-3" data-line-number="3">  t_cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">14</span>)); <span class="kw">names</span>(t_cols) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, traits<span class="op">$</span>long_name)</a>
<a class="sourceLine" id="cb225-4" data-line-number="4">  cap &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>) <span class="st">&quot;Mega-Analytic Personality-Outcome Associations in Matched Samples&quot;</span> <span class="cf">else</span> <span class="kw">sprintf</span>(<span class="st">&quot;Mega-Analytic %s Moderation of Personality-Outcome Associations in Matched Samples&quot;</span>, m)</a>
<a class="sourceLine" id="cb225-5" data-line-number="5">  d <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb225-6" data-line-number="6"><span class="st">    </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate_OR<span class="op">:</span>Q94<span class="fl">.5</span>_OR), <span class="op">~</span><span class="kw">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-7" data-line-number="7"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s, %s]&quot;</span>, Estimate_OR, Q5<span class="fl">.5</span>_OR, Q94<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb225-8" data-line-number="8">           <span class="dt">est =</span> <span class="kw">ifelse</span>(sig <span class="op">==</span><span class="st"> &quot;sig&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;&lt;strong&gt;%s&lt;/strong&gt;&quot;</span>, est), est)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-9" data-line-number="9"><span class="st">    </span><span class="kw">select</span>(Trait, Outcome, <span class="dt">Term =</span> names, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-10" data-line-number="10"><span class="st">    </span><span class="co"># spread it wide and order Outcomes, columns, and studies</span></a>
<a class="sourceLine" id="cb225-11" data-line-number="11"><span class="st">    </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span> , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>, <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-12" data-line-number="12"><span class="st">    </span><span class="kw">left_join</span>(<span class="kw">crossing</span>(<span class="dt">Outcome =</span> outcomes<span class="op">$</span>short_name, <span class="dt">Trait =</span> traits<span class="op">$</span>short_name, <span class="dt">value  =</span> <span class="ot">NA_character_</span>, <span class="dt">Term =</span> <span class="kw">unique</span>(d<span class="op">$</span>names)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">spread</span>(Trait, value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-13" data-line-number="13"><span class="st">    </span><span class="kw">select</span>(Outcome, Term, <span class="kw">one_of</span>(traits<span class="op">$</span>short_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-14" data-line-number="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Term =</span> <span class="kw">str_to_title</span>(<span class="kw">str_replace</span>(<span class="kw">str_remove</span>(Term, <span class="st">&quot;p_value:&quot;</span>), mod, <span class="kw">paste</span>(m, <span class="st">&quot; &quot;</span>, <span class="dt">sep =</span><span class="st">&quot;&quot;</span>))),</a>
<a class="sourceLine" id="cb225-15" data-line-number="15">           <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span> outcomes<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-16" data-line-number="16"><span class="st">    </span><span class="kw">arrange</span>(Outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-17" data-line-number="17"><span class="st">    </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb225-18" data-line-number="18">          , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb225-19" data-line-number="19">          , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb225-20" data-line-number="20">          , <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Term&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;OR [CI]&quot;</span>, <span class="dt">times =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb225-21" data-line-number="21">          , <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb225-22" data-line-number="22">          , <span class="dt">caption =</span> cap) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-23" data-line-number="23"><span class="st">    </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-24" data-line-number="24"><span class="st">    </span><span class="kw">add_header_above</span>(t_cols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-25" data-line-number="25"><span class="st">    </span><span class="kw">footnote</span>(<span class="st">&quot;&lt;em&gt;OR&lt;/em&gt; = Odds Ratio; &lt;em&gt;UI&lt;/em&gt; = 89% Bayesian Uncertainty Interval. Bold indicates model terms whose 89% UI of log odds did not overlap with 0.&quot;</span>, <span class="dt">escape =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-26" data-line-number="26"><span class="st">    </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/fixed/%s.html&quot;</span>, wd, mod))</a>
<a class="sourceLine" id="cb225-27" data-line-number="27">}</a>
<a class="sourceLine" id="cb225-28" data-line-number="28"></a>
<a class="sourceLine" id="cb225-29" data-line-number="29">fx_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-30" data-line-number="30"><span class="st">  </span><span class="kw">filter</span>((Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span>)<span class="op">|</span></a>
<a class="sourceLine" id="cb225-31" data-line-number="31"><span class="st">         </span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-32" data-line-number="32"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>), <span class="st">&quot;sig&quot;</span>, <span class="st">&quot;ns&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-33" data-line-number="33"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>(Estimate<span class="op">:</span>Q94<span class="fl">.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-34" data-line-number="34"><span class="st">  </span><span class="kw">group_by</span>(Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-35" data-line-number="35"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-36" data-line-number="36"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-37" data-line-number="37"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tab =</span> <span class="kw">map2</span>(data, Moderator, psm_fxd_tab_fun))</a>
<a class="sourceLine" id="cb225-38" data-line-number="38"></a>
<a class="sourceLine" id="cb225-39" data-line-number="39">t_cols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">14</span>)); <span class="kw">names</span>(t_cols) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb225-40" data-line-number="40">rs &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">start =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">1</span>, <span class="dt">by =</span> <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">14</span>),</a>
<a class="sourceLine" id="cb225-41" data-line-number="41">            <span class="dt">end =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">10</span>, <span class="dt">length.out =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb225-42" data-line-number="42"></a>
<a class="sourceLine" id="cb225-43" data-line-number="43">fx_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-44" data-line-number="44"><span class="st">  </span><span class="kw">filter</span>((Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-45" data-line-number="45"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="kw">ifelse</span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>), <span class="st">&quot;sig&quot;</span>, <span class="st">&quot;ns&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-46" data-line-number="46"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>(Estimate<span class="op">:</span>Q94<span class="fl">.5</span>)) <span class="op">%&gt;%</span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate_OR<span class="op">:</span>Q94<span class="fl">.5</span>_OR), <span class="op">~</span><span class="kw">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-47" data-line-number="47"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s, %s]&quot;</span>, Estimate_OR, Q5<span class="fl">.5</span>_OR, Q94<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb225-48" data-line-number="48">           <span class="dt">est =</span> <span class="kw">ifelse</span>(sig <span class="op">==</span><span class="st"> &quot;sig&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;&lt;strong&gt;%s&lt;/strong&gt;&quot;</span>, est), est)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-49" data-line-number="49"><span class="st">    </span><span class="kw">select</span>(Trait, Outcome, <span class="dt">Term =</span> names, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-50" data-line-number="50"><span class="st">    </span><span class="co"># spread it wide and order Outcomes, columns, and studies</span></a>
<a class="sourceLine" id="cb225-51" data-line-number="51"><span class="st">    </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span> , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>, <span class="dt">names_sep =</span> <span class="st">&quot;_&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-52" data-line-number="52"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Term =</span> <span class="kw">str_remove</span>(Term, <span class="st">&quot;p_value:&quot;</span>),</a>
<a class="sourceLine" id="cb225-53" data-line-number="53">         <span class="dt">Term =</span> <span class="kw">factor</span>(Term, <span class="dt">levels =</span> moderators<span class="op">$</span>short_name, <span class="dt">labels =</span> moderators<span class="op">$</span>breaks),</a>
<a class="sourceLine" id="cb225-54" data-line-number="54">           <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span> outcomes<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-55" data-line-number="55"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(Term)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-56" data-line-number="56"><span class="st">    </span><span class="kw">arrange</span>(Outcome, Term) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-57" data-line-number="57"><span class="st">    </span><span class="kw">select</span>(Outcome, Term, <span class="kw">one_of</span>(traits<span class="op">$</span>short_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-58" data-line-number="58"><span class="st">    </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb225-59" data-line-number="59">          , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb225-60" data-line-number="60">          , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb225-61" data-line-number="61">          , <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Term&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;OR [CI]&quot;</span>, <span class="dt">times =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb225-62" data-line-number="62">          , <span class="dt">align =</span> <span class="kw">c</span>( <span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb225-63" data-line-number="63">          , <span class="dt">caption =</span> <span class="st">&quot;Mega-Analytic Moderators of Personality-Outcome Associations in Matched Samples&quot;</span> ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-64" data-line-number="64"><span class="st">    </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-65" data-line-number="65"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Mortality&quot;, rs$start[1], rs$end[1], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-66" data-line-number="66"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Major Health Event&quot;, rs$start[2], rs$end[2], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-67" data-line-number="67"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Mental Health Event&quot;, rs$start[3], rs$end[3], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-68" data-line-number="68"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Child Birth&quot;,rs$start[4], rs$end[4], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-69" data-line-number="69"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Move in with a partner&quot;, rs$start[5], rs$end[5], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-70" data-line-number="70"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Marriage&quot;, rs$start[6], rs$end[6], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-71" data-line-number="71"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Divorce&quot;, rs$start[7], rs$end[7], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-72" data-line-number="72"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Child Moves Out&quot;, rs$start[8], rs$end[8], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-73" data-line-number="73"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Higher Education&quot;, rs$start[9], rs$end[9], label_row_css = NULL)  %&gt;%</span></a>
<a class="sourceLine" id="cb225-74" data-line-number="74"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;First Job&quot;, rs$start[10], rs$end[10], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-75" data-line-number="75"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Unemployment&quot;, rs$start[11], rs$end[11], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-76" data-line-number="76"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Retirement&quot;, rs$start[12], rs$end[12], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-77" data-line-number="77"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Volunteering&quot;, rs$start[13], rs$end[13], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-78" data-line-number="78"><span class="st">    </span><span class="co"># kableExtra::group_rows(&quot;Criminality&quot;, rs$start[14], rs$end[14], label_row_css = NULL) %&gt;%</span></a>
<a class="sourceLine" id="cb225-79" data-line-number="79"><span class="st">    </span><span class="co"># collapse_rows(1, valign = &quot;top&quot;) %&gt;%</span></a>
<a class="sourceLine" id="cb225-80" data-line-number="80"><span class="st">    </span><span class="kw">add_header_above</span>(t_cols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb225-81" data-line-number="81"><span class="st">    </span><span class="kw">footnote</span>(<span class="st">&quot;&lt;em&gt;OR&lt;/em&gt; = Odds Ratio; &lt;em&gt;UI&lt;/em&gt; = 89% Bayesian Uncertainty Interval. Bold indicates model terms whose 89% UI of log odds did not overlap with 0. Binary variables were dummy coded such that the label to the right of the &#39;v&#39; indicates the reference group.&quot;</span>, <span class="dt">escape =</span> F) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/fixed/all_moderators.html&quot;</span>, wd))</a></code></pre></div>
</div>
<div id="significant-fixed-effects" class="section level5">
<h5><span class="header-section-number">4.4.1.2.3</span> Significant Fixed Effects</h5>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" data-line-number="1">fx_me &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb226-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span> <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb226-3" data-line-number="3"><span class="st">        </span><span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>))</a>
<a class="sourceLine" id="cb226-4" data-line-number="4">fx_me</a></code></pre></div>
<pre><code>## # A tibble: 64 x 12
##    Trait Outcome Moderator names Estimate Est.Error     Q5.5    Q94.5 Estimate_OR
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1 A     crim    none      p_va  -0.0467    0.0230 -0.0837  -0.0104        0.954
##  2 A     divorc none      p_va   0.0504    0.0210  0.0189   0.0838        1.05 
##  3 A     married none      p_va   0.0364    0.0123  0.0177   0.0557        1.04 
##  4 A     physhl none      p_va   0.0247    0.0127  0.00458  0.0440        1.03 
##  5 A     vlntred none      p_va   0.0351    0.0139  0.0130   0.0566        1.04 
##  6 C     chldbr none      p_va   0.0327    0.0199  0.00345  0.0655        1.03 
##  7 C     divorc none      p_va   0.0362    0.0161  0.0114   0.0622        1.04 
##  8 C     edu     none      p_va  -0.0297    0.0163 -0.0551  -0.00380       0.971
##  9 C     married none      p_va   0.0347    0.0164  0.00955  0.0606        1.04 
## 10 C     mntlhl none      p_va  -0.0354    0.0168 -0.0611  -0.00819       0.965
## #  with 54 more rows, and 3 more variables: Est.Error_OR &lt;dbl&gt;, Q5.5_OR &lt;dbl&gt;,
## #   Q94.5_OR &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" data-line-number="1">fx_mod &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb228-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names) <span class="op">&amp;</span><span class="st"> </span><span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>)) </a>
<a class="sourceLine" id="cb228-3" data-line-number="3">fx_mod</a></code></pre></div>
<pre><code>## # A tibble: 107 x 12
##    Trait Outcome Moderator names Estimate Est.Error     Q5.5    Q94.5 Estimate_OR
##    &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;
##  1 A     chldbr age       p_va -0.00226   0.00116 -3.95e-3 -5.35e-4       0.998
##  2 A     chldbr predInt   p_va -0.0130    0.00421 -1.96e-2 -6.26e-3       0.987
##  3 A     married age       p_va -0.00301   0.00171 -5.87e-3 -7.57e-4       0.997
##  4 A     mntlhl parOccPr p_va  0.00788   0.00442  9.43e-4  1.49e-2       1.01 
##  5 A     mntlhl predInt   p_va -0.00831   0.00521 -1.64e-2 -1.79e-4       0.992
##  6 A     mortal gender    p_va -0.0470    0.0220  -8.20e-2 -1.26e-2       0.954
##  7 A     retired parEdu    p_va  0.0981    0.0555   1.27e-2  1.88e-1       1.10 
##  8 C     chldbr gender    p_va -0.0301    0.0185  -5.89e-2 -1.07e-3       0.970
##  9 C     chldbr parEdu    p_va  0.0656    0.0254   2.69e-2  1.06e-1       1.07 
## 10 C     chldbr predInt   p_va -0.0133    0.00729 -2.43e-2 -1.88e-3       0.987
## #  with 97 more rows, and 3 more variables: Est.Error_OR &lt;dbl&gt;, Q5.5_OR &lt;dbl&gt;,
## #   Q94.5_OR &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
<div id="variance-covariance-matrices" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Variance-Covariance Matrices</h3>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" data-line-number="1">load_fun &lt;-<span class="st"> </span><span class="cf">function</span>(file, ob){</a>
<a class="sourceLine" id="cb230-2" data-line-number="2">  <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/vc/%s&quot;</span>, wd, file))</a>
<a class="sourceLine" id="cb230-3" data-line-number="3">  <span class="kw">get</span>(<span class="kw">ls</span>()[<span class="kw">ls</span>() <span class="op">==</span><span class="st"> </span>ob])</a>
<a class="sourceLine" id="cb230-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb230-5" data-line-number="5"></a>
<a class="sourceLine" id="cb230-6" data-line-number="6">vc_fun &lt;-<span class="st"> </span><span class="cf">function</span>(vc){</a>
<a class="sourceLine" id="cb230-7" data-line-number="7">  vc<span class="op">$</span>sd <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb230-8" data-line-number="8"><span class="st">    </span><span class="kw">data.frame</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-9" data-line-number="9"><span class="st">    </span><span class="kw">rownames_to_column</span>(<span class="st">&quot;names&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-10" data-line-number="10"><span class="st">    </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb230-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb230-12" data-line-number="12"></a>
<a class="sourceLine" id="cb230-13" data-line-number="13">vc_res &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> <span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/vc&quot;</span>, wd))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-14" data-line-number="14"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">remove =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Moderator =</span> <span class="kw">str_remove</span>(Moderator, <span class="st">&quot;.RData&quot;</span>),</a>
<a class="sourceLine" id="cb230-16" data-line-number="16">         <span class="dt">vc =</span> <span class="kw">map</span>(file, <span class="op">~</span><span class="kw">load_fun</span>(., <span class="st">&quot;vc&quot;</span>)),</a>
<a class="sourceLine" id="cb230-17" data-line-number="17">         <span class="dt">sd =</span> <span class="kw">map</span>(vc, vc_fun))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb230-18" data-line-number="18"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>scrap, <span class="op">-</span>file)</a>
<a class="sourceLine" id="cb230-19" data-line-number="19">vc_res</a></code></pre></div>
<pre><code>## # A tibble: 1,747 x 5
##    Trait Outcome   Moderator   vc               sd              
##    &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;list&gt;           &lt;list&gt;          
##  1 A     chldbrth  age         &lt;named list [3]&gt; &lt;tibble [4  5]&gt;
##  2 A     chldbrth  gender      &lt;named list [3]&gt; &lt;tibble [4  5]&gt;
##  3 A     chldbrth  grsWages    &lt;named list [3]&gt; &lt;tibble [4  5]&gt;
##  4 A     chldbrth  none        &lt;named list [3]&gt; &lt;tibble [2  5]&gt;
##  5 A     chldbrth  parEdu      &lt;named list [3]&gt; &lt;tibble [6  5]&gt;
##  6 A     chldbrth  parOccPrstg &lt;named list [3]&gt; &lt;tibble [4  5]&gt;
##  7 A     chldbrth  predInt     &lt;named list [3]&gt; &lt;tibble [2  5]&gt;
##  8 A     chldbrth  race        &lt;named list [3]&gt; &lt;tibble [6  5]&gt;
##  9 A     chldbrth  reliability &lt;named list [3]&gt; &lt;tibble [2  5]&gt;
## 10 A     chldmvout age         &lt;named list [3]&gt; &lt;tibble [4  5]&gt;
## #  with 1,737 more rows</code></pre>
<div id="tables-1" class="section level4">
<h4><span class="header-section-number">4.4.2.1</span> Tables</h4>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" data-line-number="1">vc_var &lt;-<span class="st"> </span>vc_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>vc) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>Moderator <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>((Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span>names <span class="op">==</span><span class="st"> &quot;p_value&quot;</span>) <span class="op">|</span></a>
<a class="sourceLine" id="cb232-6" data-line-number="6"><span class="st">         </span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.))</a>
<a class="sourceLine" id="cb232-8" data-line-number="8">  <span class="co"># mutate(sig = ifelse(sign(Q5.5) == sign(Q94.5), &quot;sig&quot;, &quot;ns&quot;)) %&gt;%</span></a>
<a class="sourceLine" id="cb232-9" data-line-number="9">  <span class="co"># mutate_at(vars(Estimate, Q5.5, Q94.5), ~(.)^2)</span></a>
<a class="sourceLine" id="cb232-10" data-line-number="10"></a>
<a class="sourceLine" id="cb232-11" data-line-number="11">hcols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">15</span>)</a>
<a class="sourceLine" id="cb232-12" data-line-number="12"><span class="kw">names</span>(hcols) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb232-13" data-line-number="13">vc_var <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-14" data-line-number="14"><span class="st">  </span><span class="kw">filter</span>(Moderator <span class="op">==</span><span class="st"> &quot;none&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), </a>
<a class="sourceLine" id="cb232-16" data-line-number="16">    <span class="op">~</span><span class="kw">ifelse</span>(<span class="kw">abs</span>(.) <span class="op">&lt;</span><span class="st"> </span><span class="fl">.01</span>, <span class="kw">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, .), <span class="kw">sprintf</span>(<span class="st">&quot;%.2f&quot;</span>, .))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="op">~</span><span class="kw">str_remove</span>(., <span class="st">&quot;^0&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s,%s]&quot;</span>, Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb232-19" data-line-number="19">         <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span>  outcomes<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-20" data-line-number="20"><span class="st">  </span><span class="kw">select</span>(Trait, Outcome, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-21" data-line-number="21"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-22" data-line-number="22"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span></a>
<a class="sourceLine" id="cb232-23" data-line-number="23">              , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-24" data-line-number="24"><span class="st">  </span><span class="kw">select</span>(Outcome, <span class="kw">all_of</span>(traits<span class="op">$</span>short_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-25" data-line-number="25"><span class="st">  </span><span class="kw">arrange</span>(Outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-26" data-line-number="26"><span class="st">  </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb232-27" data-line-number="27">        , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb232-28" data-line-number="28">        , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb232-29" data-line-number="29">        , <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb232-30" data-line-number="30">        , <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;b [CI]&quot;</span>, <span class="dv">14</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-31" data-line-number="31"><span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-32" data-line-number="32"><span class="st">  </span><span class="kw">add_header_above</span>(hcols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-33" data-line-number="33"><span class="st">  </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/level 2/p_value_none.html&quot;</span>, wd))</a>
<a class="sourceLine" id="cb232-34" data-line-number="34"></a>
<a class="sourceLine" id="cb232-35" data-line-number="35">hcols &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">15</span>)</a>
<a class="sourceLine" id="cb232-36" data-line-number="36"><span class="kw">names</span>(hcols) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb232-37" data-line-number="37">vc_var <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-38" data-line-number="38"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="op">~</span><span class="kw">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-39" data-line-number="39"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="op">~</span><span class="kw">str_remove</span>(., <span class="st">&quot;^0&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-40" data-line-number="40"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s, %s]&quot;</span>, Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb232-41" data-line-number="41">         <span class="dt">names =</span> <span class="kw">str_remove</span>(names, <span class="st">&quot;p_value:&quot;</span>),</a>
<a class="sourceLine" id="cb232-42" data-line-number="42">         <span class="dt">names =</span> <span class="kw">factor</span>(names, <span class="kw">c</span>(<span class="st">&quot;p_value&quot;</span>, moderators<span class="op">$</span>short_name), <span class="kw">c</span>(<span class="st">&quot;None&quot;</span>, moderators<span class="op">$</span>long_name)),</a>
<a class="sourceLine" id="cb232-43" data-line-number="43">         <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span>  outcomes<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-44" data-line-number="44"><span class="st">  </span><span class="kw">select</span>(Trait, Outcome, <span class="dt">Moderator =</span> names, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-45" data-line-number="45"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-46" data-line-number="46"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span></a>
<a class="sourceLine" id="cb232-47" data-line-number="47">              , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-48" data-line-number="48"><span class="st">  </span><span class="kw">select</span>(Outcome, Moderator, <span class="kw">all_of</span>(traits<span class="op">$</span>short_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-49" data-line-number="49"><span class="st">  </span><span class="kw">arrange</span>(Outcome, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-50" data-line-number="50"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-51" data-line-number="51"><span class="st">  </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb232-52" data-line-number="52">        , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb232-53" data-line-number="53">        , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb232-54" data-line-number="54">        , <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb232-55" data-line-number="55">        , <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Moderator&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;b [CI]&quot;</span>, <span class="dv">14</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-56" data-line-number="56"><span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-57" data-line-number="57"><span class="st">  </span><span class="kw">add_header_above</span>(hcols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-58" data-line-number="58"><span class="st">  </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/level 2/all_mods.html&quot;</span>, wd))</a>
<a class="sourceLine" id="cb232-59" data-line-number="59"></a>
<a class="sourceLine" id="cb232-60" data-line-number="60">vc_tab_fun &lt;-<span class="st"> </span><span class="cf">function</span>(d, mod){</a>
<a class="sourceLine" id="cb232-61" data-line-number="61">  hcols &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">14</span>))</a>
<a class="sourceLine" id="cb232-62" data-line-number="62">  <span class="kw">names</span>(hcols) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot; &quot;</span>, traits<span class="op">$</span>short_name)</a>
<a class="sourceLine" id="cb232-63" data-line-number="63">  d <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-64" data-line-number="64"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="op">~</span><span class="kw">sprintf</span>(<span class="st">&quot;%.3f&quot;</span>, .)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-65" data-line-number="65"><span class="st">  </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="op">~</span><span class="kw">str_remove</span>(., <span class="st">&quot;^0&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-66" data-line-number="66"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">est =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s&lt;br&gt;[%s, %s]&quot;</span>, Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>),</a>
<a class="sourceLine" id="cb232-67" data-line-number="67">         <span class="dt">names =</span> <span class="kw">str_remove</span>(names, <span class="st">&quot;p_value:&quot;</span>),</a>
<a class="sourceLine" id="cb232-68" data-line-number="68">         <span class="dt">names =</span> <span class="kw">factor</span>(names, <span class="kw">c</span>(<span class="st">&quot;p_value&quot;</span>, moderators<span class="op">$</span>short_name), <span class="kw">c</span>(<span class="st">&quot;None&quot;</span>, moderators<span class="op">$</span>long_name)),</a>
<a class="sourceLine" id="cb232-69" data-line-number="69">         <span class="dt">Outcome =</span> <span class="kw">factor</span>(Outcome, <span class="dt">levels =</span> outcomes<span class="op">$</span>short_name, <span class="dt">labels =</span>  outcomes<span class="op">$</span>long_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-70" data-line-number="70"><span class="st">  </span><span class="kw">select</span>(Trait, Outcome, <span class="dt">Moderator =</span> names, est) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-71" data-line-number="71"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">complete.cases</span>(.)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-72" data-line-number="72"><span class="st">  </span><span class="kw">pivot_wider</span>(<span class="dt">names_from =</span> <span class="st">&quot;Trait&quot;</span></a>
<a class="sourceLine" id="cb232-73" data-line-number="73">              , <span class="dt">values_from =</span> <span class="st">&quot;est&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-74" data-line-number="74"><span class="st">  </span><span class="kw">select</span>(Outcome, Moderator, <span class="kw">all_of</span>(traits<span class="op">$</span>short_name)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-75" data-line-number="75"><span class="st">  </span><span class="kw">arrange</span>(Outcome, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-76" data-line-number="76"><span class="st">  </span><span class="co"># select(-Outcome) %&gt;%</span></a>
<a class="sourceLine" id="cb232-77" data-line-number="77"><span class="st">  </span><span class="kw">kable</span>(.</a>
<a class="sourceLine" id="cb232-78" data-line-number="78">        , <span class="st">&quot;html&quot;</span></a>
<a class="sourceLine" id="cb232-79" data-line-number="79">        , <span class="dt">escape =</span> F</a>
<a class="sourceLine" id="cb232-80" data-line-number="80">        , <span class="dt">align =</span> <span class="kw">c</span>(<span class="st">&quot;r&quot;</span>, <span class="st">&quot;r&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;c&quot;</span>, <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb232-81" data-line-number="81">        , <span class="dt">col.names =</span> <span class="kw">c</span>(<span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>, <span class="kw">rep</span>(<span class="st">&quot;b [CI]&quot;</span>, <span class="dv">14</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-82" data-line-number="82"><span class="st">  </span><span class="kw">kable_styling</span>(<span class="dt">full_width =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-83" data-line-number="83"><span class="st">  </span><span class="kw">add_header_above</span>(hcols) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-84" data-line-number="84"><span class="st">  </span><span class="kw">save_kable</span>(., <span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/tables/level 2/%s.html&quot;</span>, wd, mod))</a>
<a class="sourceLine" id="cb232-85" data-line-number="85">}</a>
<a class="sourceLine" id="cb232-86" data-line-number="86"></a>
<a class="sourceLine" id="cb232-87" data-line-number="87">vc_var <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-88" data-line-number="88"><span class="st">  </span><span class="kw">filter</span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-89" data-line-number="89"><span class="st">  </span><span class="kw">group_by</span>(Moderator) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-90" data-line-number="90"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-91" data-line-number="91"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb232-92" data-line-number="92"><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">map2</span>(data, Moderator, vc_tab_fun))</a></code></pre></div>
</div>
</div>
<div id="simple-effects" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Simple Effects</h3>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1">load_fun &lt;-<span class="st"> </span><span class="cf">function</span>(file, ob){</a>
<a class="sourceLine" id="cb233-2" data-line-number="2">  <span class="kw">load</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/predicted/%s&quot;</span>, wd, file))</a>
<a class="sourceLine" id="cb233-3" data-line-number="3">  <span class="kw">get</span>(<span class="kw">ls</span>()[<span class="kw">ls</span>() <span class="op">==</span><span class="st"> </span>ob])</a>
<a class="sourceLine" id="cb233-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb233-5" data-line-number="5"></a>
<a class="sourceLine" id="cb233-6" data-line-number="6">fx_pred &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">file =</span> <span class="kw">list.files</span>(<span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/predicted&quot;</span>, wd))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-7" data-line-number="7"><span class="st">  </span><span class="kw">separate</span>(file, <span class="kw">c</span>(<span class="st">&quot;scrap&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;Trait&quot;</span>, <span class="st">&quot;Outcome&quot;</span>, <span class="st">&quot;Moderator&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>, <span class="dt">remove =</span> F) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Moderator =</span> <span class="kw">str_remove</span>(Moderator, <span class="st">&quot;.RData&quot;</span>),</a>
<a class="sourceLine" id="cb233-9" data-line-number="9">         <span class="dt">fx =</span> <span class="kw">map</span>(file, <span class="op">~</span><span class="kw">load_fun</span>(., <span class="st">&quot;pred.fx&quot;</span>)),</a>
<a class="sourceLine" id="cb233-10" data-line-number="10">         <span class="dt">rx =</span> <span class="kw">map</span>(file, <span class="op">~</span><span class="kw">load_fun</span>(., <span class="st">&quot;pred.rx&quot;</span>)))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>scrap, <span class="op">-</span>type, <span class="op">-</span>file)</a>
<a class="sourceLine" id="cb233-12" data-line-number="12"></a>
<a class="sourceLine" id="cb233-13" data-line-number="13"><span class="co"># random effects predictions</span></a>
<a class="sourceLine" id="cb233-14" data-line-number="14">rx_pred &lt;-<span class="st"> </span>fx_pred <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>fx)</a>
<a class="sourceLine" id="cb233-15" data-line-number="15"><span class="co"># fixed effect predictions</span></a>
<a class="sourceLine" id="cb233-16" data-line-number="16">fx_pred &lt;-<span class="st"> </span>fx_pred <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span>rx)</a></code></pre></div>
<div id="all-fixed-effect-simple-effects" class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> All Fixed-Effect Simple Effects</h4>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1">simp_eff_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, outcome, mod){ </a>
<a class="sourceLine" id="cb234-2" data-line-number="2">  <span class="kw">print</span>(<span class="kw">paste</span>(outcome, mod))</a>
<a class="sourceLine" id="cb234-3" data-line-number="3">  o &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(outcome, outcomes<span class="op">$</span>short_name, outcomes<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb234-4" data-line-number="4">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>mod, moderators<span class="op">$</span>mod_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb234-5" data-line-number="5">  d &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">min</span>(df<span class="op">$</span>Estimate_OR)), <span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">max</span>(df<span class="op">$</span>Estimate_OR))), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb234-6" data-line-number="6">  mini &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="fl">.05</span> <span class="cf">else</span> <span class="dv">1</span><span class="op">-</span>(d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)) </a>
<a class="sourceLine" id="cb234-7" data-line-number="7">  maxi &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="fl">2.05</span> <span class="cf">else</span> <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb234-8" data-line-number="8">  lim &lt;-<span class="st"> </span><span class="kw">c</span>(mini, maxi)</a>
<a class="sourceLine" id="cb234-9" data-line-number="9">  brk &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="cf">else</span>{<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">10</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">10</span>)),<span class="dv">2</span>)}</a>
<a class="sourceLine" id="cb234-10" data-line-number="10">  lab &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>){<span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)} <span class="cf">else</span>{<span class="kw">str_remove</span>(<span class="kw">c</span>(<span class="kw">round</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">10</span>),<span class="dv">2</span>), <span class="dv">1</span>, <span class="kw">round</span>(<span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">10</span>),<span class="dv">2</span>)), <span class="st">&quot;^0&quot;</span>)}</a>
<a class="sourceLine" id="cb234-11" data-line-number="11">  titl &lt;-<span class="st"> </span><span class="cf">if</span>(mod <span class="op">==</span><span class="st"> &quot;none&quot;</span>){o} <span class="cf">else</span> {<span class="kw">sprintf</span>(<span class="st">&quot;%s: Personality x %s Simple Effects&quot;</span>, o, m)}</a>
<a class="sourceLine" id="cb234-12" data-line-number="12">  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>unclass <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb234-13" data-line-number="13">  df<span class="op">$</span>mod_value &lt;-<span class="st"> </span>df[,mod]</a>
<a class="sourceLine" id="cb234-14" data-line-number="14">  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">all_of</span>(mod)) <span class="op">%&gt;%</span><span class="st"> </span>as_tibble</a>
<a class="sourceLine" id="cb234-15" data-line-number="15">  <span class="cf">if</span>(<span class="kw">class</span>(df<span class="op">$</span>mod_value) <span class="op">==</span><span class="st"> &quot;factor&quot;</span>){df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mod_fac =</span> <span class="kw">factor</span>(mod_value))} </a>
<a class="sourceLine" id="cb234-16" data-line-number="16">  <span class="cf">else</span>{df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-17" data-line-number="17"><span class="st">    </span><span class="kw">group_by</span>(Trait) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-18" data-line-number="18"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mod_fac =</span> <span class="kw">factor</span>(mod_value, <span class="dt">levels =</span> <span class="kw">unique</span>(mod_value), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;-1 SD&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;+1 SD&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-19" data-line-number="19"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb234-20" data-line-number="20">  }</a>
<a class="sourceLine" id="cb234-21" data-line-number="21">  lt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dotted&quot;</span>, <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;dashed&quot;</span>)[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>mod_fac))]</a>
<a class="sourceLine" id="cb234-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb234-23" data-line-number="23">  df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-24" data-line-number="24"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Trait =</span> <span class="kw">factor</span>(Trait, <span class="dt">levels =</span> traits<span class="op">$</span>short_name, <span class="dt">labels =</span> traits<span class="op">$</span>long_name),</a>
<a class="sourceLine" id="cb234-25" data-line-number="25">           <span class="dt">Q5.5_OR =</span> <span class="kw">ifelse</span>(Q5<span class="fl">.5</span>_OR <span class="op">&lt;</span><span class="st"> </span>mini, mini, Q5<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb234-26" data-line-number="26">           <span class="dt">Q94.5_OR =</span> <span class="kw">ifelse</span>(Q94<span class="fl">.5</span>_OR <span class="op">&gt;</span><span class="st"> </span>maxi, maxi, Q94<span class="fl">.5</span>_OR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-27" data-line-number="27"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p_value</a>
<a class="sourceLine" id="cb234-28" data-line-number="28">               , <span class="dt">y =</span> Estimate_OR</a>
<a class="sourceLine" id="cb234-29" data-line-number="29">               , <span class="dt">group  =</span> mod_fac))  <span class="op">+</span></a>
<a class="sourceLine" id="cb234-30" data-line-number="30"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> lim</a>
<a class="sourceLine" id="cb234-31" data-line-number="31">                         , <span class="dt">breaks =</span> brk</a>
<a class="sourceLine" id="cb234-32" data-line-number="32">                         , <span class="dt">labels =</span> lab) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-33" data-line-number="33"><span class="st">      </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> lt) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-34" data-line-number="34"><span class="st">      </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>), <span class="dt">size =</span> <span class="fl">.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-35" data-line-number="35"><span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q5<span class="fl">.5</span>_OR</a>
<a class="sourceLine" id="cb234-36" data-line-number="36">                      , <span class="dt">ymax =</span> Q94<span class="fl">.5</span>_OR</a>
<a class="sourceLine" id="cb234-37" data-line-number="37">                      , <span class="dt">fill =</span> mod_fac)</a>
<a class="sourceLine" id="cb234-38" data-line-number="38">                  , <span class="dt">alpha =</span> <span class="fl">.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-39" data-line-number="39"><span class="st">      </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype =</span> mod_fac)) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-40" data-line-number="40"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Personality (POMP)&quot;</span></a>
<a class="sourceLine" id="cb234-41" data-line-number="41">           , <span class="dt">y =</span> <span class="st">&quot;Odds Ratio&quot;</span></a>
<a class="sourceLine" id="cb234-42" data-line-number="42">           , <span class="dt">title =</span> titl</a>
<a class="sourceLine" id="cb234-43" data-line-number="43">           , <span class="dt">linetype =</span> m</a>
<a class="sourceLine" id="cb234-44" data-line-number="44">           , <span class="dt">fill =</span> m) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-45" data-line-number="45"><span class="st">      </span><span class="kw">facet_wrap</span>(<span class="op">~</span>Trait, <span class="dt">nrow =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb234-46" data-line-number="46"><span class="st">      </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb234-47" data-line-number="47"><span class="st">      </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb234-48" data-line-number="48">            , <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="fl">1.2</span>), <span class="dt">hjust =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb234-49" data-line-number="49">            , <span class="dt">strip.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb234-50" data-line-number="50">            , <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb234-51" data-line-number="51">            , <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>))</a>
<a class="sourceLine" id="cb234-52" data-line-number="52">  <span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/simple effects/%s/matched_%s.pdf&quot;</span>, wd, mod, outcome), <span class="dt">width =</span> <span class="dv">12</span>, <span class="dt">height =</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb234-53" data-line-number="53">}</a>
<a class="sourceLine" id="cb234-54" data-line-number="54"></a>
<a class="sourceLine" id="cb234-55" data-line-number="55">fx_pred<span class="op">$</span>fx[fx_pred<span class="op">$</span>Trait<span class="op">==</span><span class="st">&quot;IQ&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Outcome<span class="op">==</span><span class="st"> &quot;chldmvout&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Moderator<span class="op">==</span><span class="st">&quot;race&quot;</span>][[<span class="dv">1</span>]] &lt;-<span class="st"> </span>fx_pred<span class="op">$</span>fx[fx_pred<span class="op">$</span>Trait<span class="op">==</span><span class="st">&quot;IQ&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Outcome<span class="op">==</span><span class="st"> &quot;chldmvout&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Moderator<span class="op">==</span><span class="st">&quot;race&quot;</span>][[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">race =</span> <span class="kw">factor</span>(race))</a>
<a class="sourceLine" id="cb234-56" data-line-number="56">fx_pred<span class="op">$</span>fx[fx_pred<span class="op">$</span>Moderator <span class="op">==</span><span class="st"> &quot;predInt&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Trait <span class="op">==</span><span class="st"> &quot;NA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Outcome <span class="op">==</span><span class="st"> &quot;chldmvout&quot;</span>][[<span class="dv">1</span>]] &lt;-<span class="st"> </span>fx_pred<span class="op">$</span>fx[fx_pred<span class="op">$</span>Moderator <span class="op">==</span><span class="st"> &quot;predInt&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Trait <span class="op">==</span><span class="st"> &quot;NA&quot;</span> <span class="op">&amp;</span><span class="st"> </span>fx_pred<span class="op">$</span>Outcome <span class="op">==</span><span class="st"> &quot;chldmvout&quot;</span>][[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">predInt =</span> <span class="kw">as.numeric</span>(<span class="kw">as.character</span>(predInt)))</a>
<a class="sourceLine" id="cb234-57" data-line-number="57"></a>
<a class="sourceLine" id="cb234-58" data-line-number="58">fx_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-59" data-line-number="59"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>Moderator <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SES&quot;</span>, <span class="st">&quot;reliability&quot;</span>, <span class="st">&quot;predInt&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-60" data-line-number="60"><span class="st">  </span><span class="kw">group_by</span>(Outcome, Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-61" data-line-number="61"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-62" data-line-number="62"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb234-63" data-line-number="63"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(fx) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="kw">lst</span>(<span class="dt">OR =</span> exp))),</a>
<a class="sourceLine" id="cb234-64" data-line-number="64">         <span class="dt">plot =</span> <span class="kw">pmap</span>(<span class="kw">list</span>(data, Outcome, Moderator), simp_eff_fun))</a></code></pre></div>
</div>
<div id="reliable-simple-effects" class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> Reliable Simple Effects</h4>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1">sig_simp_eff_fun &lt;-<span class="st"> </span><span class="cf">function</span>(df, mod){ </a>
<a class="sourceLine" id="cb235-2" data-line-number="2">  <span class="kw">print</span>(<span class="kw">paste</span>(mod))</a>
<a class="sourceLine" id="cb235-3" data-line-number="3">  num_sig &lt;-<span class="st"> </span><span class="kw">nrow</span>(df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(Trait, Outcome) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">distinct</span>())</a>
<a class="sourceLine" id="cb235-4" data-line-number="4">  ncols &lt;-<span class="st"> </span><span class="cf">if</span>(num_sig<span class="op">%/%</span><span class="dv">5</span><span class="op">&gt;=</span><span class="dv">2</span>) <span class="dv">5</span> <span class="cf">else</span> <span class="dv">3</span></a>
<a class="sourceLine" id="cb235-5" data-line-number="5">  nrows &lt;-<span class="st"> </span><span class="kw">ceiling</span>(num_sig <span class="op">/</span><span class="st"> </span>ncols)</a>
<a class="sourceLine" id="cb235-6" data-line-number="6">  m &lt;-<span class="st"> </span><span class="kw">mapvalues</span>(mod, moderators<span class="op">$</span>short_name, moderators<span class="op">$</span>long_name, <span class="dt">warn_missing =</span> F)</a>
<a class="sourceLine" id="cb235-7" data-line-number="7">  d &lt;-<span class="st"> </span><span class="kw">round</span>(<span class="kw">max</span>(<span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">min</span>(df<span class="op">$</span>Estimate_OR)), <span class="kw">abs</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">max</span>(df<span class="op">$</span>Estimate_OR))), <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb235-8" data-line-number="8">  mini &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="fl">.05</span> <span class="cf">else</span> <span class="dv">1</span><span class="op">-</span>(d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)) </a>
<a class="sourceLine" id="cb235-9" data-line-number="9">  maxi &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="fl">2.05</span> <span class="cf">else</span> <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb235-10" data-line-number="10">  lim &lt;-<span class="st"> </span><span class="kw">c</span>(mini, maxi)</a>
<a class="sourceLine" id="cb235-11" data-line-number="11">  brk &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="cf">else</span>{<span class="kw">round</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">10</span>), <span class="dv">1</span>, <span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">10</span>)),<span class="dv">2</span>)}</a>
<a class="sourceLine" id="cb235-12" data-line-number="12">  lab &lt;-<span class="st"> </span><span class="cf">if</span>(d <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>){<span class="kw">c</span>(<span class="st">&quot;0&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>)} <span class="cf">else</span>{<span class="kw">str_remove</span>(<span class="kw">c</span>(<span class="kw">round</span>(<span class="dv">1</span><span class="op">-</span>d<span class="op">-</span>(d<span class="op">/</span><span class="dv">10</span>),<span class="dv">2</span>), <span class="dv">1</span>, <span class="kw">round</span>(<span class="dv">1</span><span class="op">+</span>d<span class="op">+</span>(d<span class="op">/</span><span class="dv">10</span>),<span class="dv">2</span>)), <span class="st">&quot;^0&quot;</span>)}</a>
<a class="sourceLine" id="cb235-13" data-line-number="13">  titl &lt;-<span class="st"> </span><span class="kw">sprintf</span>(<span class="st">&quot;Simple Effects of %s Moderating Personality-Outcome Associations&quot;</span>, m)</a>
<a class="sourceLine" id="cb235-14" data-line-number="14">  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>unclass <span class="op">%&gt;%</span><span class="st"> </span>data.frame</a>
<a class="sourceLine" id="cb235-15" data-line-number="15">  df<span class="op">$</span>mod_value &lt;-<span class="st"> </span>df[,mod]</a>
<a class="sourceLine" id="cb235-16" data-line-number="16">  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">all_of</span>(mod)) <span class="op">%&gt;%</span><span class="st"> </span>as_tibble</a>
<a class="sourceLine" id="cb235-17" data-line-number="17">  <span class="cf">if</span>(<span class="kw">class</span>(df<span class="op">$</span>mod_value) <span class="op">==</span><span class="st"> &quot;factor&quot;</span>){df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="dt">mod_fac =</span> <span class="kw">factor</span>(mod_value))} </a>
<a class="sourceLine" id="cb235-18" data-line-number="18">  <span class="cf">else</span>{df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-19" data-line-number="19"><span class="st">    </span><span class="kw">group_by</span>(Trait, Outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-20" data-line-number="20"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">mod_fac =</span> <span class="kw">factor</span>(mod_value, <span class="dt">levels =</span> <span class="kw">unique</span>(mod_value), <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;-1 SD&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;+1 SD&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-21" data-line-number="21"><span class="st">    </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb235-22" data-line-number="22">  }</a>
<a class="sourceLine" id="cb235-23" data-line-number="23">  lt &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;dotted&quot;</span>, <span class="st">&quot;solid&quot;</span>, <span class="st">&quot;dashed&quot;</span>)[<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(<span class="kw">unique</span>(df<span class="op">$</span>mod_fac))]</a>
<a class="sourceLine" id="cb235-24" data-line-number="24">  shrt_levs &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(outcomes<span class="op">$</span>short_name, <span class="dt">each =</span> <span class="dv">14</span>), <span class="kw">rep</span>(traits<span class="op">$</span>short_name, <span class="dt">times =</span> <span class="dv">14</span>))</a>
<a class="sourceLine" id="cb235-25" data-line-number="25">  long_levs &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="kw">rep</span>(outcomes<span class="op">$</span>long_name, <span class="dt">each =</span> <span class="dv">14</span>), <span class="kw">rep</span>(traits<span class="op">$</span>long_name, <span class="dt">times =</span> <span class="dv">14</span>), <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb235-26" data-line-number="26">  df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-27" data-line-number="27"><span class="st">    </span><span class="kw">unite</span>(levs, Outcome, Trait, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-28" data-line-number="28"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">levs =</span> <span class="kw">factor</span>(levs, shrt_levs, long_levs),</a>
<a class="sourceLine" id="cb235-29" data-line-number="29">           <span class="dt">Q5.5_OR =</span> <span class="kw">ifelse</span>(Q5<span class="fl">.5</span>_OR <span class="op">&lt;</span><span class="st"> </span>mini, mini, Q5<span class="fl">.5</span>_OR),</a>
<a class="sourceLine" id="cb235-30" data-line-number="30">           <span class="dt">Q94.5_OR =</span> <span class="kw">ifelse</span>(Q94<span class="fl">.5</span>_OR <span class="op">&gt;</span><span class="st"> </span>maxi, maxi, Q94<span class="fl">.5</span>_OR)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-31" data-line-number="31"><span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> p_value</a>
<a class="sourceLine" id="cb235-32" data-line-number="32">               , <span class="dt">y =</span> Estimate_OR</a>
<a class="sourceLine" id="cb235-33" data-line-number="33">               , <span class="dt">group  =</span> mod_fac))  <span class="op">+</span></a>
<a class="sourceLine" id="cb235-34" data-line-number="34"><span class="st">      </span><span class="kw">scale_y_continuous</span>(<span class="dt">limits =</span> lim</a>
<a class="sourceLine" id="cb235-35" data-line-number="35">                         , <span class="dt">breaks =</span> brk</a>
<a class="sourceLine" id="cb235-36" data-line-number="36">                         , <span class="dt">labels =</span> lab) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-37" data-line-number="37"><span class="st">      </span><span class="kw">scale_linetype_manual</span>(<span class="dt">values =</span> lt) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-38" data-line-number="38"><span class="st">      </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> <span class="dv">1</span>), <span class="dt">size =</span> <span class="fl">.25</span>, <span class="dt">color =</span> <span class="st">&quot;gray50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-39" data-line-number="39"><span class="st">      </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> Q5<span class="fl">.5</span>_OR</a>
<a class="sourceLine" id="cb235-40" data-line-number="40">                      , <span class="dt">ymax =</span> Q94<span class="fl">.5</span>_OR</a>
<a class="sourceLine" id="cb235-41" data-line-number="41">                      , <span class="dt">fill =</span> mod_fac)</a>
<a class="sourceLine" id="cb235-42" data-line-number="42">                  , <span class="dt">alpha =</span> <span class="fl">.25</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-43" data-line-number="43"><span class="st">      </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">linetype =</span> mod_fac)) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-44" data-line-number="44"><span class="st">      </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Personality (POMP)&quot;</span></a>
<a class="sourceLine" id="cb235-45" data-line-number="45">           , <span class="dt">y =</span> <span class="st">&quot;Odds Ratio&quot;</span></a>
<a class="sourceLine" id="cb235-46" data-line-number="46">           , <span class="dt">title =</span> titl</a>
<a class="sourceLine" id="cb235-47" data-line-number="47">           , <span class="dt">linetype =</span> m</a>
<a class="sourceLine" id="cb235-48" data-line-number="48">           , <span class="dt">fill =</span> m) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-49" data-line-number="49"><span class="st">      </span><span class="kw">facet_wrap</span>(<span class="op">~</span>levs, <span class="dt">ncol =</span> ncols, <span class="dt">nrow =</span> nrows) <span class="op">+</span></a>
<a class="sourceLine" id="cb235-50" data-line-number="50"><span class="st">      </span><span class="kw">theme_classic</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb235-51" data-line-number="51"><span class="st">      </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span></a>
<a class="sourceLine" id="cb235-52" data-line-number="52">            , <span class="dt">panel.background =</span> <span class="kw">element_rect</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb235-53" data-line-number="53">            , <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="dt">size =</span> <span class="kw">rel</span>(<span class="fl">1.2</span>), <span class="dt">hjust =</span> <span class="fl">.5</span>)</a>
<a class="sourceLine" id="cb235-54" data-line-number="54">            , <span class="dt">strip.background =</span> <span class="kw">element_blank</span>()<span class="co">#element_rect(fill = &quot;black&quot;)</span></a>
<a class="sourceLine" id="cb235-55" data-line-number="55">            , <span class="dt">strip.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb235-56" data-line-number="56">            , <span class="dt">axis.text =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>))</a>
<a class="sourceLine" id="cb235-57" data-line-number="57">  <span class="kw">ggsave</span>(<span class="dt">file =</span> <span class="kw">sprintf</span>(<span class="st">&quot;%s/results/psm/matched/plots/simple effects/reliable/matched_%s.pdf&quot;</span>, wd, mod), <span class="dt">width =</span> ncols<span class="op">*</span><span class="dv">2</span><span class="op">+</span><span class="dv">2</span>, <span class="dt">height =</span> nrows<span class="op">*</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb235-58" data-line-number="58">}</a>
<a class="sourceLine" id="cb235-59" data-line-number="59"></a>
<a class="sourceLine" id="cb235-60" data-line-number="60">sig_mod &lt;-<span class="st"> </span>fx_res <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-61" data-line-number="61"><span class="st">  </span><span class="kw">filter</span>(Moderator <span class="op">!=</span><span class="st"> &quot;none&quot;</span> <span class="op">&amp;</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-62" data-line-number="62"><span class="st">         </span><span class="kw">grepl</span>(<span class="st">&quot;p_value:&quot;</span>, names) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb235-63" data-line-number="63"><span class="st">         </span>(<span class="kw">sign</span>(Q5<span class="fl">.5</span>) <span class="op">==</span><span class="st"> </span><span class="kw">sign</span>(Q94<span class="fl">.5</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-64" data-line-number="64"><span class="st">  </span><span class="kw">select</span>(Trait, Outcome, Moderator) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb235-65" data-line-number="65"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-66" data-line-number="66"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sig =</span> <span class="st">&quot;sig&quot;</span>)</a>
<a class="sourceLine" id="cb235-67" data-line-number="67"></a>
<a class="sourceLine" id="cb235-68" data-line-number="68">fx_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-69" data-line-number="69"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>Moderator <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SES&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-70" data-line-number="70"><span class="st">  </span><span class="kw">left_join</span>(sig_mod) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-71" data-line-number="71"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(sig)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-72" data-line-number="72"><span class="st">  </span><span class="kw">arrange</span>(Moderator, Outcome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-73" data-line-number="73"><span class="st">  </span><span class="kw">group_by</span>(Moderator) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-74" data-line-number="74"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-75" data-line-number="75"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb235-76" data-line-number="76"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="kw">map</span>(data, <span class="op">~</span>(.) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(fx) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate_at</span>(<span class="kw">vars</span>(Estimate, Q5<span class="fl">.5</span>, Q94<span class="fl">.5</span>), <span class="kw">lst</span>(<span class="dt">OR =</span> exp))),</a>
<a class="sourceLine" id="cb235-77" data-line-number="77">         <span class="dt">plot =</span> <span class="kw">map2</span>(data, Moderator, sig_simp_eff_fun))</a></code></pre></div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="propensity-score-matching-psm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="specification-curve-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/03-PSM_mods.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
